
﻿
function namespace(namespaceString){var parts=namespaceString.split('.'),parent=window,currentPart='';for(var i=0,length=parts.length;i<length;i++){currentPart=parts[i];parent[currentPart]=parent[currentPart]||{};parent=parent[currentPart];}
return parent;}﻿
var loc=window.location.pathname;var dir=loc.substring(0,loc.lastIndexOf('/'));this.baseURL=dir+'/';var JSO=namespace('JSO');var JSO_Client=namespace('JSO.Client');var DEBUG=false;if(typeof exports!='undefined'){JSO.Client=exports;}else{JSO.Client=this.JSO.Client={};}
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
(function(){var Globals=namespace('JSO.Client.Globals')
this.FLOAT_ARRAY=Float32Array;this.GAME_LOOP_TIME=0;this.RADS_TO_DEGREES=(180/Math.PI);this.DEGREES_TO_RADS=(Math.PI/180);JSO.Client.Globals={MODEL:'model',VIEW:'view',CONTROLLER:'controller',SEARCH_UP:1<<1,SEARCH_DOWN:1<<2,SEARCH_UPDOWN:2^4,BINDING_TYPES:{BASE:0,ROOT:1,OBJ:2,ATTR:3,REF:4,FN:5,FRAMEWORK:6,NATIVE:7,XML_ATTRIBUTE:8,XML_CLASS:9},BINDING_CHANNEL:{NONE:0,GET:1<<1,SET:1<<2,GETSET:2^4},REST_METHOD:{GET:1,PUT:2,POST:3,DELETE:4},currentUid:0,uniqueId:function(){return this.currentUid++;},currentUBit:0,uniqueBit:function(){JSO.Client.Globals.currentUBit++;return 1<<JSO.Client.Globals.currentUBit;},collisionBits:{},validators:{isValidString:function(value){return value!=undefined;},isValidInt:function(value){return!isNaN(parseInt(value))&&isFinite(value);},isValidFloat:function(value){return!isNaN(parseFloat(value))&&isFinite(value);},isValidBool:function(value){return(value!=undefined&&('true,false,0,1,-1'.match(value)!=undefined));},isValidB2Vec2:function(value){if(value!=undefined&&(value instanceof Box2D.Common.Math.b2Vec2)){return!isNaN(parseFloat(value.x))&&isFinite(value.x)&&!isNaN(parseFloat(value.y))&&isFinite(value.y)}else return false;},validateType:function(value,type){switch(type.toLowerCase()){case'string':return this.isValidString(value);break;case'int':return this.isValidInt(value);break;case'float':return this.isValidFloat(value);break;case'bool':return this.isValidBool(value);break;case'b2vec2':return this.isValidB2Vec2(value);break;default:}},fn:function(type){switch(type.toLowerCase()){case'string':return this.isValidString;break;case'int':return this.isValidInt;break;case'float':return this.isValidFloat;break;case'bool':return this.isValidBool;break;case'b2vec2':return this.isValidB2Vec2;break;default:}},validate:function(value,type){if(type=='b2Vec2'){return this.validateType(value,type);}else if(value instanceof Array){var i=value.length;while(i--){if(!this.validateType(value[i],type))return false;}
return true;}else{return typeof(value)=='string'?(value+'').match(',')!=null?this.parse(validate.split(','),type):this.validateType(value,type):this.validateType(value,type);}}},parsers:{parseString:function(value){return(JSO.Client.Globals.validators.isValidString(value)?value:'');},parseInt:function(value){return(JSO.Client.Globals.validators.isValidInt(value)?Math.floor(value):0);},parseFloat:function(value){return(JSO.Client.Globals.validators.isValidFloat(value)?parseFloat(value):0.0);},parseBool:function(value){return(JSO.Client.Globals.validators.isValidBool(value)?('true,1,-1'.match(value)!=undefined):false);},parseB2Vec2:function(value){if(value!=undefined){if(value instanceof Box2D.Common.Math.b2Vec2){return JSO.Client.Globals.validators.isValidB2Vec2(value)?value:new Box2D.Common.Math.b2Vec2(this.parseFloat(value.x),this.parseFloat(value.y));}else if(value instanceof Array){if(value.length>=2){return new Box2D.Common.Math.b2Vec2(this.parseFloat(value[0]),this.parseFloat(value[1]))}else if(value.length=1){return new Box2D.Common.Math.b2Vec2(this.parseFloat(value[0]),0.0)}else{return new Box2D.Common.Math.b2Vec2(0.0,0.0);}}else{return typeof(value)=='string'?JSO.Client.Globals.parsers.parseB2Vec2(value.split(',')):new Box2D.Common.Math.b2Vec2(this.parseFloat(value),0.0)}}else return new Box2D.Common.Math.b2Vec2(0.0,0.0);},parseType:function(value,type){switch(type){case'string':return this.parseString(value);break;case'int':return this.parseInt(value);break;case'float':return this.parseFloat(value);break;case'bool':return this.parseBool(value);break;case'b2vec2':return this.parseB2Vec2(value);break;default:}},fn:function(type){switch(type.toLowerCase()){case'string':return this.parseString;break;case'int':return this.parseInt;break;case'float':return this.parseFloat;break;case'bool':return this.parseBool;break;case'b2vec2':return this.parseB2Vec2;break;default:}},parse:function(value,type){if(type.toLowerCase()=='b2vec2'){return this.parseType(value,type);}else if(value instanceof Array){var arr=[];var i=value.length;while(i--){arr[i]=this.parseType(value[i],type);}
return arr;}else{return typeof(value)=='string'?(value+'').match(',')!=null?this.parse(value.split(','),type):this.parseType(value,type):this.parseType(value,type);}}},scaleValue:function(value,type,scale){if(!JSO.Client.Globals.validators.isValidFloat(scale))return;if(value instanceof Box2D.Common.Math.b2Vec2){return new Box2D.Common.Math.b2Vec2(value.x/scale,value.y/scale);}else if(type=='b2Vec2'){return JSO.Client.Globals.scaleValue(JSO.Client.Globals.parsers.parse(value,type));}else if(value instanceof Array){var newVal=[];var i=value.length;while(i--){newVal[i]=JSO.Client.Globals.parsers.parse(value[i]/scale,type);}
return newVal;}else return JSO.Client.Globals.parsers.parse(value/scale,type);},readChainAttr:function(source,attrArray){var attr=attrArray.shift();if(attrArray.length>0){return readChainAttr(source[attr],attrArray);}else{return(source==undefined?undefined:source[attr]);}},getChainAttr:function(source,attrArray){var attr=attrArray.shift();if(attrArray.length>0){return getChainAttr(source[attr],attrArray);}else{return(source==undefined?undefined:source);}},getChainObj:function(source,attrArray){var attr=attrArray.shift();if(typeof source=='object'){return getChainObj(source[attr],attrArray);}else{return(source==undefined?undefined:source);}},getChainNonReservedObj:function(source,attrArray){var attr=attrArray.shift();var match=(KEYWORDS+',object').match(attr);if(match!=''&&match!=undefined&&attrArray.length){if(source[attr])return JSO.Client.Globals.getChainNonReservedObj(source[attr],attrArray);return undefined;}else{attrArray.unshift(attr);return(source==undefined?undefined:source);}},getChainNonReservedAttr:function(source,attrArray){var attr=attrArray.shift();var match=(KEYWORDS+',object').match(attr);if(match!=''&&match!=undefined&&attrArray.length){return getChainNonReservedAttr(source[attr],attrArray);}else{attrArray.unshift(attr);return attr;}}}
JSO.Client.Clonable=function(){this.clone=function(source){for(i in source){if(typeof source[i]=='source'){this[i]=new this.clone(source[i]);}
else{this[i]=source[i];}}}}})();﻿
(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;var grapClass=namespace('JSO.Client.Class');JSO.Client.Class=function(){};JSO.Client.Class.prototype.clonable=true;JSO.Client.Class.prototype.clone=function(clonedList,clones){var clonedList=clonedList||[];var clones=clones||[];var clone={};clonedList.push(this.uid);clones.push(clone);for(var key in this){clone[key]=this.cloneAttr(key,clonedList,clones);}
clone.uid=JSO.Client.Globals.uniqueId();clone.uidString=padNumber(clone.uid,32);return clone;}
JSO.Client.Class.prototype.cloneAttr=function(key,clonedList,clones){if(['attributes','events','bindings'].indexOf(key)>-1){var node={};for(var subkey in this[key]){if(this[key][subkey].clone&&this[key][subkey].uid){if(this[key][subkey].clonable){node[subkey]=this[key][subkey].clone(clonedList,clones);}else node[subkey]=this[key][subkey];}}
return node;}else if(typeof(this[key])=='object'){if(this[key].uid){if(this[key].clonable){if(clonedList.indexOf(this[key].uid)==-1){return this[key].clone(clonedList,clones);}else return clones[clonedList.indexOf(this[key].uid)];}else this[key];}else if(this[key].Copy){return this[key].Copy();}
else if(this[key]instanceof Array){var node=[];var i=this[key].length
while(i--){if(typeof(this[key][i])=='object'){if(this[key][i].uid){if(this[key][i].clonable){if(clonedList.indexOf(this[key][i].uid)==-1){node[i]=this[key][i].clone(clonedList,clones);}else node[i]=clones[clonedList.indexOf(this[key][i].uid)];}else node[i]=this[key][i];}else if(this[key][i].Copy)node[i]=this[key][i].Copy();else if(this[key][i].clone)node[i]=this[key][i].clone();else node[i]=this[key][i];}else node[i]=this[key][i];}
return node;}else if(this[key].clone){return this[key].clone();}
else return this[key];}else{return this[key];}}
JSO.Client.Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=='function'&&typeof _super[name]=='function'&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}
function Class(){if(!initializing&&this.construct){if(!this.constructed){this.construct.apply(this,arguments);}
this.constructed=true;this.uid=JSO.Client.Globals.uniqueId();this.uidString=padNumber(this.uid,32);}}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();﻿
(function(){this.EventArray=function(name,handler,context){EventArray.prototype.constructor=EventArray;this.context=context;this.handlers={};if(name){this.context=context;this.handlers[name]=handler;}};EventArray.prototype=[];EventArray.prototype.length=Array.prototype.length;EventArray.prototype.push=function(){for(var i=0;i<arguments.length;i++){Array.prototype.push.call(this,arguments[i]);}
if(this.handlers['push']){this.handlers['push'].apply(this.context||this,['push',arguments[0]]);}};EventArray.prototype.pop=function(){var itm=Array.prototype.pop.call(this,[]);if(this.handlers['pop']){this.handlers['pop'].apply(this.context||this,['pop',itm]);}
return itm;};EventArray.prototype.setHandler=function(name,f,context){this.context=context;this.handlers[name]=f;};EventArray.prototype.callHandler=function(name){if(this.handlers[name]){this.handlers[name].apply(this.context||this,name);}};EventArray.prototype.call=function(fn){var rv=[];var i=this.length;while(i--){var obj=this[i];if(typeof(obj)=='object')rv.push(obj[fn]());}
return rv;};EventArray.prototype.move=function(old_index,new_index){while(old_index<0){old_index+=this.length;}
while(new_index<0){new_index+=this.length;}
if(new_index>=this.length){var k=new_index-this.length;while((k--)+1){this.push(undefined);}}
this.splice(new_index,0,this.splice(old_index,1)[0]);return this;};})();﻿
(function(){var lastTime=0;var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!window.requestAnimationFrame)
window.requestAnimationFrame=function(callback,element){var currTime=new Date.now();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window.cancelAnimationFrame)
window.cancelAnimationFrame=function(id){clearTimeout(id);};}());function addProperty(obj,name,onGet,onSet){var
oldValue=obj[name],getFn=function(){return onGet.apply(obj,[oldValue]);},setFn=function(newValue){return oldValue=onSet.apply(obj,[newValue]);};if(Object.defineProperty){Object.defineProperty(obj,name,{get:getFn,set:setFn});}else if(obj.__defineGetter__){obj.__defineGetter__(name,getFn);obj.__defineSetter__(name,setFn);}else{var onPropertyChange=function(e){if(event.propertyName==name){obj.detachEvent("onpropertychange",onPropertyChange);var newValue=setFn(obj[name]);obj[name]=getFn;obj[name].toString=getFn;obj.attachEvent("onpropertychange",onPropertyChange);}};obj[name]=getFn;obj[name].toString=getFn;obj.attachEvent("onpropertychange",onPropertyChange);}};function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n);};function padNumber(number,pad,pad_char){var c=typeof pad_char!=='undefined'?pad_char:'0';var p=new Array(1+pad).join(c);return(p+number).slice(-p.length);};function isValidDefault(value,dt){switch(dt.toLowerCase()){case'string':return(value&&value!=undefined);break;case'int':return(value&&parseFloat(value)!=0);break;case'float':return(value&&parseFloat(value)!=0);break;case'bool':return(value&&value!=undefined);break;case'b2vec2':return true;break;default:}};function isFloat(value){if(/\./.test(value)){return true;}else{return false;}};function extractPattern(str,re){var results=[],text;while(text=re.exec(str)){results.push(text[1]);}
return results;};function valueIsExpression(value){if(typeof(value)!='string')return false;return(value.indexOf('[')>=0||value.indexOf(']')>=0||value.indexOf('{')>=0||value.indexOf('}')>=0);};function isPointInPoly(poly,pt){for(var c=false,i=-1,l=poly.length,j=l-1;++i<l;j=i)
((poly[i].y<=pt.y&&pt.y<poly[j].y)||(poly[j].y<=pt.y&&pt.y<poly[i].y))&&(pt.x<(poly[j].x-poly[i].x)*(pt.y-poly[i].y)/(poly[j].y-poly[i].y)+poly[i].x)&&(c=!c);return c;};function intersect(a,b){return(a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom)};function clone(src){function mixin(dest,source,copyFunc){var name,s,i,empty={};for(name in source){s=source[name];if(!(name in dest)||(dest[name]!==s&&(!(name in empty)||empty[name]!==s))){dest[name]=copyFunc?copyFunc(s):s;}}
return dest;}
if(!src||typeof src!="object"||Object.prototype.toString.call(src)==="[object Function]"){return src;}
if(src.nodeType&&"cloneNode"in src){return src.cloneNode(true);}
if(src instanceof Date){return new Date(src.getTime());}
if(src instanceof RegExp){return new RegExp(src);}
var r,i,l;if(src instanceof Array){r=[];for(i=0,l=src.length;i<l;++i){if(i in src){r.push(clone(src[i]));}}}else{r=src.constructor?new src.constructor():{};}
return mixin(r,src,clone);};function deepCopy(obj){if(Object.prototype.toString.call(obj)==='[object Array]'){var out=[],i=0,len=obj.length;for(;i<len;i++){out[i]=arguments.callee(obj[i]);}
return out;}
if(typeof obj==='object'){var out={},i;for(i in obj){out[i]=arguments.callee(obj[i]);}
return out;}
return obj;};$.fn.filterNodeByAttr=function(attr,value){return this.find('*').filter(function(){if(this.attributes[attr]){return this.attributes[attr].value==value;}else return false;});};$.fn.filterNode=function(name){return this.find('*').filter(function(){return this.nodeName===name;});};jQuery.extend({deepclone:function(objThing){if(jQuery.isArray(objThing)){return jQuery.makeArray(jQuery.deepclone($(objThing)));}
return jQuery.extend(true,{},objThing);},});Date.prototype.today=function(){return((this.getDate()<10)?"0":"")+this.getDate()+"/"+(((this.getMonth()+1)<10)?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()};Date.prototype.timeNow=function(){return((this.getHours()<10)?"0":"")+this.getHours()+":"+((this.getMinutes()<10)?"0":"")+this.getMinutes()+":"+((this.getSeconds()<10)?"0":"")+this.getSeconds();};Number.prototype.clamp=function(min,max){return Math.min(Math.max(this,min),max);};Array.prototype.clone=function(){return this.slice(0);}
Array.prototype.flatten=function(){return[].concat.apply([],this);}
Box2D.Common.Math.b2Vec2.prototype.Divide=function(a){var newVal=new Box2D.Common.Math.b2Vec2(this.x,this.y);if(a instanceof Box2D.Common.Math.b2Vec2&&a.x!=0&&a.y!=0){newVal.x/=a.x;newVal.y/=a.y;}
return newVal;};Box2D.Common.Math.b2Vec2.prototype.toString=function(){return this.x+','+this.y;};﻿(function(){JSO.Client.ExecutionQueue=function(process,context,items,callback,nextQueue,fps){this.uid=JSO.Client.Globals.uniqueId();this.queue=[];this.nextQueue=nextQueue;this.items=items;this.process=process;this.context=context;this.callback=callback;this.fps=fps;this.complete=false;this.lastExec=Date.now();this.doNext=function(){if(this.fps&&Date.now()-this.lastExec<1000/this.fps)return;if(this.items){var nextItem=this.items.shift();if(nextItem)this.process.apply(this.context,[nextItem]);if(!this.items.length){if(this.callback)this.callback.apply(this.context,[]);this.complete=true;}}else{this.process.apply(this.context,[]);this.complete=true;}
if(this.complete&&this.nextQueue!=undefined){this.nextQueue.doNext.apply(this.nextQueue,[]);this.nextQueue=undefined;}}}})();﻿
(function(){JSO.Client.LinkedList=JSO.Client.Class.extend({constructor:JSO.Client.LinkedList,construct:function(){this.events={};if(!this.prev)this.prev=undefined;if(!this.next)this.next=undefined;},last:function(){if(this.next)return this.next.last();else return this;},first:function(){if(this.prev)return this.prev.first();else return this;},find:function(typename){if(this.typename==typename)return this;else if(this.next)return this.next.find(typename);},insertBefore:function(item){if(this.prev){this.prev.next=item;item.prev=this.prev;item.next=this;this.prev=item;}else{item.next=this;this.prev=item;}
if(this.events.insert)this.events.insert(this);return item;},insertAfter:function(item){if(this.next){this.next.prev=item;item.prev=this;item.next=this.next;this.next=item;}else{item.prev=this;this.next=item;}
if(this.events.insert)this.events.insert(this);return item;},remove:function(){if(this.events.remove)this.events.remove(this);if(this.next&&this.prev){this.next.prev=this.prev;this.prev.next=this.next;}
if(this.next&&!this.prev){this.next.prev=undefined;}
if(this.prev&&!this.next){this.prev.next=undefined;}
this.next=undefined;this.prev=undefined;},destroy:function(){if(this.events.destroy&&!this._isDestroyed){this._isDestroyed=true;if(this.eventContext)this.events.destroy.apply(this.eventContext,[this]);this.events.destroy=undefined;}
this.remove();}});})();﻿
(function()
{var XML_NODE_TYPE={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REF:5,ENTITY:6,PROC_INSTR:7,COMMENT:8,DOCUMENT:9,DOC_TYPE:10,DOC_FRAG:11,NOTATION:12};if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest();}
else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
xmlhttp.open("GET",baseURL+"data/gameData.xml",false);xmlhttp.send();xmlDoc=xmlhttp.responseXML;var DAL=namespace('JSO.Client.DAL');JSO.Client.DAL=JSO.Client.Class.extend({constructor:JSO.Client.DAL,construct:function(){this.DATA_CONNECTION='http://localhost';this.resources=xmlDoc.getElementsByTagName('resources')[0];this.settings=xmlDoc.getElementsByTagName('settings')[0];this.loadResources();this.loadSettings();},loadSettings:function(){var i=this.settings.childNodes.length;window.SETTINGS={};while(i--){var nod=this.settings.childNodes[i];if(nod.nodeType==XML_NODE_TYPE.ELEMENT||nod.nodeType==XML_NODE_TYPE.ATTRIBUTE||nod.nodeType==XML_NODE_TYPE.ENTITY){window[nod.tagName]=isNumeric(nod.textContent)?parseFloat(nod.textContent):nod.textContent;window.SETTINGS[nod.tagName]=window[nod.tagName];if(nod.attributes['values']){window[nod.tagName+'.values']=nod.attributes['values'].value;}}}
var meta=this.resources=xmlDoc.getElementsByTagName('meta')[0];var mdls=xmlDoc.getElementsByTagName('model');var m=mdls.length;while(m--){var nod=mdls[m];this.getXMLNode('typename',nod.attributes['typename'].value,meta)
var a=nod.childNodes.length;while(a--){var attrNod=nod.childNodes[a];if(this.isValidXMLNode(attrNod)){if(attrNod.attributes['typename']){window.ATTRIBUTE_NAMES+=(window.ATTRIBUTE_NAMES==undefined?'':',')+nod.attributes['typename'].value+'.'+attrNod.attributes['typename'].value}}}}
var vws=xmlDoc.getElementsByTagName('model');var v=vws.length;while(v--){var nod=vws[v];this.getXMLNode('typename',nod.attributes['typename'].value,meta)
var a=nod.childNodes.length;while(a--){var attrNod=nod.childNodes[a];if(this.isValidXMLNode(attrNod)){if(attrNod.attributes['typename']){window.ATTRIBUTE_NAMES+=(window.ATTRIBUTE_NAMES==undefined?'':',')+nod.attributes['typename'].value+'.'+attrNod.attributes['typename'].value}}}}},loadResources:function(){this.images={};var i=this.resources.childNodes.length;while(i--){var nod=this.resources.childNodes[i];if(this.isValidXMLNode(nod)){switch(nod.tagName){case'image':var imgObj={typename:nod.attributes['typename'].value,image:new Image()}
imgObj.image.src=baseURL+nod.attributes['src'].value;var a=nod.attributes.length;while(a--){var attrName=nod.attributes[a].nodeName;var attrVal=nod.attributes[a].nodeValue;imgObj.image[attrName]=attrVal;}
this.images[nod.attributes['typename'].value]=imgObj;break;default:}}}},loadCache:function(){this.cache={};this.cache.types={};this.loadTypeCacheRecurse(this.getXMLNode('id',1,xmlDoc.getElementsByTagName('data')[0]));},loadTypeCacheRecurse:function(nod){var meta=this.getXMLNode('typename',nod.tagName,xmlDoc.getElementsByTagName('meta')[0]);this.cache.types[nod.tagName]={rootTypename:nod.tagName,metatype:meta.tagName}
this.loadTypes(this.getXMLNode('typename',nod.tagName,xmlDoc.getElementsByTagName('meta')[0]),nod.tagName,nod.tagName);var i=nod.childNodes.length;while(i--){var child=nod.childNodes[i];if(this.isValidXMLNode(child))this.loadTypeCacheRecurse(child);}},loadTypes:function(nod,typename,dataTypename){if(nod.attributes['inheritsFrom']){var nextNode=this.getXMLNode('typename',nod.attributes['inheritsFrom'].value,xmlDoc.getElementsByTagName('meta')[0]);if(this.isValidXMLNode(nextNode))this.loadTypes(nextNode,nod.attributes['inheritsFrom'].value,dataTypename);}
if((nod.tagName=='model'&&JSO.Client.Model.Factory.hasType(typename))||(nod.tagName=='view'&&JSO.Client.View.Factory.hasType(typename))){this.cache.types[dataTypename]={rootTypename:nod.attributes['typename'].value,metatype:nod.tagName}}},isValidXMLNode:function(nod){if(nod.nodeType==XML_NODE_TYPE.ELEMENT||nod.nodeType==XML_NODE_TYPE.ATTRIBUTE||nod.nodeType==XML_NODE_TYPE.ENTITY||nod.nodeType==XML_NODE_TYPE.ENTITY_REF)return true;return false;},getXMLNode:function(name,value,node){var i=node.childNodes.length;while(i--){var nod=node.childNodes[i];if(this.isValidXMLNode(nod)){if(name.toLowerCase()=='tagname'){if(nod.tagName==value)return nod;}else{if(nod.attributes[name]){if(nod.attributes[name].value==value)return nod;}}
var child=this.getXMLNode(name,value,nod);if(child!=undefined)return child;}}
return;},RESTControllerMethod:function(methodType,method,params){params=params||0;switch(methodType){case'GET':var ajaxReq=$.ajax({url:JSO.Client.Globals.DAL.DATA_CONNECTION+'/WebControllerService.svc/json/Get/'+method+'/'+params,type:'GET',contentType:'text/json',dataType:'json',cache:true,async:true,success:function(html){eval(html);},error:function(xhr){eval(xhr.responseText);}});break;case'POST':break;default:break;};},RESTModelMethod:function(methodType,method,params){params=params||0;switch(methodType){case'GET':return JSO.Client.Globals.DAL.DATA_CONNECTION+'/WebModelService.svc/json/Get/'+method+'/'+params;case'POST':break;case'PUT':break;case'DELETE':break;default:break;}}});JSO.Client.Globals.DAL=new JSO.Client.DAL();})();﻿
(function(){JSO.Client.DataBinding=JSO.Client.LinkedList.extend({framework:'JSO.Client',typename:'DataBinding',constructor:JSO.Client.DataBinding,construct:function(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression){this.boundModel=boundModel;this.modelMetatype=modelMetatype;this.modelTypename=modelTypename;this.name=name||'';this.dt=dt||'string';this.arrayLength=arrayLength||undefined;this.expression=expression||undefined;this.refs=this.refs||[];this.value=this.value||undefined;this.prevValue=undefined;this.defaultValue=this.defaultValue||undefined;this.channel=this.channel||JSO.Client.Globals.BINDING_CHANNEL.GETSET;this.isRoot=this.isRoot||false;this.dirty=this.dirty||false;this.lastUpdate=0;this._super();},getter:function(){if(this.channel&JSO.Client.Globals.BINDING_CHANNEL.GET){if(GAME_LOOP_TIME!=this.lastUpdate||this.lastUpdate==0){this.lastUpdate=GAME_LOOP_TIME;this.value=this.doGet();}
return this.value;}else{if(this.next&&(this.next.channel&JSO.Client.Globals.BINDING_CHANNEL.GET))return this.next.getter();}
return this.defaultValue;},doGet:function(value){return this.value;},setter:function(value){if(this.channel&JSO.Client.Globals.BINDING_CHANNEL.SET){this.prevValue=this.value;this.doSet(value);this.lastUpdate=0;}
if(this.next&&(this.next.channel&JSO.Client.Globals.BINDING_CHANNEL.SET)&&(this.value!==this.next.value&&this.value!=undefined))this.next.setter(this.value);if((this.value!=this.prevValue||this.prevValue==undefined)&&GAME_LOOP_TIME!=this.lastUpdate)this.updateRefs();},doSet:function(value){this.value=JSO.Client.Globals.parsers.parse(value,this.dt);},updateRefs:function(){var i=this.refs.length;while(i--){var ref=this.refs[i];if(ref){if(this.value!=undefined){ref.doSet(ref.refExtension&&this.value[ref.refExtension]?this.value[ref.refExtension]:this.value);ref.boundModel[ref.name]=ref.boundModel[ref.name];}}}},assignValue:function(newValue){if(isValidDefault(newValue,this.dt))this.value=!(valueIsExpression(newValue))?newValue:this.value;if(isValidDefault(newValue,'string'))this.expression=valueIsExpression(newValue)?newValue:this.expression;},initValue:function(){if((this.value==undefined||this.value==null)&&this.arrayLength)this.value=[];if(!(this.value instanceof Array)&&!(this.value instanceof Box2D.Common.Math.b2Vec2)&&this.arrayLength&&this.value.match(',')==null)this.value=[this.value];if(!(this.value instanceof Array)&&!(this.value instanceof Box2D.Common.Math.b2Vec2)&&this.value!=undefined&&this.value!=null&&this.value.match(',')!=null){this.value=this.value.split(',');}
this.value=JSO.Client.Globals.parsers.parse(this.value,this.dt);},refresh:function(value){this.doSet(value);if(this.prev)this.prev.refresh(value);},auditChain:function(){var obj=this.first();var audit='typenames:\t\t'+obj.typeChain()+'\nexpressions:\t'+obj.expressionChain()+'\nframeworks:\t\t'+obj.frameworkChain()+'\nvalues:\t\t\t'+obj.valueChain()+'\nchannels:\t\t'+obj.channelChain()+'\nrefs:\t\t\t'+obj.refChain()+'\n';return audit;},typeChain:function(){return(this.next?this.next.typeChain()+'->':'')+'['+this.typename+']';},expressionChain:function(){return(this.next?this.next.expressionChain()+'->':'')+'['+this.modelTypename+'.'+(this.expression?this.expression:this.name)+']';},frameworkChain:function(){return(this.next?this.next.frameworkChain()+'->':'')+'['+this.framework+']';},valueChain:function(){return(this.next?this.next.valueChain()+'->':'')+(this.value instanceof Box2D.Common.Math.b2Vec2?this.value.toString():this.value)+(this.defaultValue!=this.value?'{'+this.defaultValue+'}':'');},channelChain:function(){return(this.next?this.next.channelChain()+'->':'')+'['+this.channel+']';},refChain:function(){var refs='',i=this.refs.length;while(i--){refs+=(refs==''?'':',')+this.refs[i].modelTypename+'.'+this.refs[i].name+(this.refs[i].refExtension?'.'+this.refs[i].refExtension:'');}
return(this.next?this.next.refChain()+'->':'')+'['+refs+']';},insertBefore:function(binding){if(this.prev){binding.channel=JSO.Client.Globals.BINDING_CHANNEL.SET;}else{this.channel=JSO.Client.Globals.BINDING_CHANNEL.SET;}
return this._super(binding);},insertAfter:function(binding){if(this.next){binding.channel=JSO.Client.Globals.BINDING_CHANNEL.SET;}
return this._super(binding);},remove:function(){if(this.next&&!this.prev){this.next.doSet(this.value);this.next.channel=JSO.Client.Globals.BINDING_CHANNEL.GETSET;}
if(this.prev&&!this.next){this.prev.doSet(this.value);this.prev.channel=JSO.Client.Globals.BINDING_CHANNEL.GETSET;}
this._super();},enable:function(){if(this.next){this.doSet(this.next.value);this.channel=JSO.Client.Globals.BINDING_CHANNEL.GET;}
if(this.prev&&!this.next){this.doSet(this.prev.value);this.prev.channel=JSO.Client.Globals.BINDING_CHANNEL.GET;this.channel=JSO.Client.Globals.BINDING_CHANNEL.GETSET;}},disable:function(){if(this.prev){this.channel=JSO.Client.Globals.BINDING_CHANNEL.NONE;if(this.typename=='Ref'||this.typename=='ArrayNode'){this.disconnect();}}
if(this.next&&!this.prev){this.next.doSet(this.value);this.next.channel=JSO.Client.Globals.BINDING_CHANNEL.GETSET;this.channel=JSO.Client.Globals.BINDING_CHANNEL.GET;if(this.typename=='Ref'||this.typename=='ArrayNode'){this.disconnect();}}},destroy:function(){this.refs.length=0;this.refs={};this.boundModel=null;if(this.next)this.next.destroy();this._super();}});})();﻿
(function(){JSO.Client.DataBinding.ArrayNode=JSO.Client.DataBinding.extend({framework:'Expression',typename:'ArrayNode',channel:JSO.Client.Globals.BINDING_CHANNEL.GETSET,constructor:JSO.Client.DataBinding.ArrayNode,construct:function(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression,arrayType){var expTxt=expression.join(',');this.arrayType=arrayType;this.nodes=new Array(arrayLength);var exLen=expression.length;for(var i=0;i<exLen;i++){switch(this.arrayType){case'Fn':this.nodes[i]=new JSO.Client.DataBinding.Fn(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression.shift());break;case'Ref':this.nodes[i]=new JSO.Client.DataBinding.Ref(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression.shift());break;default:}}
this.values=new Array(this.nodes.length);for(var i=0;i<this.values.length;i++){this.values[i]=('int,float,b2vec2').match(dt)?0.0:dt=='bool'?false:'';}
this.defaultValues=this.values.clone();this._super(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expTxt);},doGet:function(){for(var i=0;i<this.values.length;i++){if(this.nodes[i])this.values[i]=this.nodes[i].doGet();else this.values[i]=this.defaultValues[i];}
return JSO.Client.Globals.parsers.parse(this.values,this.dt);},doSet:function(value){this.value=this.doGet();},disconnect:function(){var i=this.nodes.length;while(i--){if(this.nodes[i].typename=='Ref')this.nodes[i].disconnect();}},remove:function(){var i=this.nodes.length;while(i--){this.nodes[i].remove();}
this._super();},destroy:function(){var i=this.nodes.length;while(i--)this.nodes[i].destroy();this._super();}});})();﻿
(function(){JSO.Client.DataBinding.Fn=JSO.Client.DataBinding.extend({framework:'Expression',typename:'Fn',channel:JSO.Client.Globals.BINDING_CHANNEL.GETSET,constructor:JSO.Client.DataBinding.Fn,construct:function(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression){this.parameters=[];if((/\[(.*?)\]/g).test(expression)){var exs=extractPattern(expression,/\[(.*?)\]/g);var exLen=exs.length;for(var i=0;i<exLen;i++){expression=expression.replace('['+exs[i]+']','params['+i+']');var param=new JSO.Client.DataBinding.Ref(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,exs.shift());this.parameters.push(param);}}
eval('this.fn = function(params) { return '+expression+'; }');this._super(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression);},doGet:function(){var params=[];for(var i=0;i<this.parameters.length;i++){params.push(this.parameters[i].doGet());}
value=this.fn(params);return value;},doSet:function(value){this.value=this.doGet();},remove:function(){var i=this.parameters.length;while(i--){this.parameters[i].remove();}
this._super();},destroy:function(){var i=this.parameters.length;while(i--){this.parameters[i].destroy();}
this._super();}});})();﻿
(function(){JSO.Client.DataBinding.FrameworkClass=JSO.Client.Class.extend({constructor:JSO.Client.DataBinding.FrameworkClass,construct:function(boundModel){this.events={};this.bound=false;this.boundModel=boundModel;}});})();﻿
(function(){JSO.Client.DataBinding.Ref=JSO.Client.DataBinding.extend({framework:'Expression',typename:'Ref',channel:JSO.Client.Globals.BINDING_CHANNEL.GETSET,constructor:JSO.Client.DataBinding.Ref,construct:function(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression){this.refName='';this.refObject=undefined;this.connected=false;if(modelMetatype=='model')expression=expression.replace('model','this');else expression=expression.replace('model','this.model').replace('view','this');this._super(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,expression);},doGet:function(){if(!this.connected)this.connect();if(this.connected)this.value=(this.refExtension&&this.refObject[this.refName]?this.refObject[this.refName][this.refExtension]:this.refObject[this.refName]);return this.value;},doSet:function(value){this.value=value;},connect:function(){if(!this.refObject){var objchain=this.expression.split('.');objchain.shift();this.refObject=JSO.Client.Globals.getChainNonReservedObj(this.boundModel,objchain);if(!this.refObject)return;this.refName=objchain[0];this.refQualifiedName=this.expression.substr(0,this.expression.indexOf(this.refName)+this.refName.length);var ext=this.expression.split('.');this.refExtension=(this.refName!=ext[ext.length-1]?ext[ext.length-1]:'');this.fullName=this.modelTypename+'.'+this.refQualifiedName+this.refExtension;if(this.refObject.attributes[this.refName]){var foreignRefs=this.refObject.attributes[this.refName].refs;var i=this.refObject.attributes[this.refName].refs.length,found=false;while(i--){if(this.refObject.attributes[this.refName].refs[i].fullName==this.fullName){found=true;}}
if(!found){this.refObject.attributes[this.refName].refs.push(this);}}
this.connected=true;}},disconnect:function(){if(this.refObject!=null&&this.refObject.attributes!=null&&this.refObject.attributes[this.refName]!=null){var foreignRefs=this.refObject.attributes[this.refName].refs;var i=foreignRefs.length;while(i--){if(foreignRefs[i].fullName==this.fullName){foreignRefs.splice(i,1);}}}},remove:function(){if(this.bound&&this.refObject!=null&&this.refObject.attributes!=null&&this.refObject.attributes[this.refName]!=null){var foreignRefs=this.refObject.attributes[this.refName].refs;var i=foreignRefs.length;while(i--){if(foreignRefs[i].fullName==this.fullName){foreignRefs.splice(i,1);}}}
this._super();}});})();﻿
(function(){JSO.Client.DataBinding.ExpressionClass=JSO.Client.DataBinding.FrameworkClass.extend({framework:'Expression',constructor:JSO.Client.ExpressionClass,construct:function(boundModel){for(var name in boundModel.attributes){var attr=boundModel.attributes[name];if(attr.expression!=null){if(attr.expression.indexOf('{')>=0||attr.expression.indexOf('}')>=0){var fns=extractPattern(attr.expression,/{([^}]+)}/g);if(attr.arrayLength||attr.dt.toLowerCase()=='b2vec2'||fns.length>1){attr.first().insertBefore(new JSO.Client.DataBinding.ArrayNode(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,fns,'Fn'));}else{attr.first().insertBefore(new JSO.Client.DataBinding.Fn(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,fns[0]));}}else if(attr.expression.indexOf('[')>=0||attr.expression.indexOf(']')>=0){var exs=extractPattern(attr.expression,/\[(.*?)\]/g);if(attr.arrayLength||attr.dt.toLowerCase()=='b2vec2'||exs.length>1){attr.first().insertBefore(new JSO.Client.DataBinding.ArrayNode(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,exs,'Ref'));}else{attr.first().insertBefore(new JSO.Client.DataBinding.Ref(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,exs[0]));}}}}
this._super();}});})();﻿
(function(){JSO.Client.DataBinding.XMLAttribute=JSO.Client.DataBinding.extend({typename:'XMLAttribute',framework:'JSO.Client',channel:JSO.Client.Globals.BINDING_CHANNEL.GETSET,constructor:JSO.Client.DataBinding.XMLAttribute,construct:function(boundModel,modelNode,attrNode,dataNode){this.attrNode=attrNode;this.modelNode=modelNode;this.dataNode=dataNode;this.name=attrNode.attributes['typename'].value;this.defaultValue=attrNode.attributes['defaultValue']?attrNode.attributes['defaultValue'].value:undefined;this.value=undefined;this.expression=valueIsExpression(this.defaultValue)?this.defaultValue:undefined;if(this.expression instanceof Array&&this.expression.length>0&&!this.arrayLength)this.arrayLength=this.expression.length;this.arrayLength=attrNode.attributes['arrayLength']?attrNode.attributes['arrayLength'].value:0;this.getmap=attrNode.attributes['getmap']?attrNode.attributes['getmap'].value:'';this.setmap=attrNode.attributes['setmap']?attrNode.attributes['setmap'].value:'';this.dt=attrNode.attributes['dt']?attrNode.attributes['dt'].value.toLowerCase():'string';this.scaleFactor=attrNode.attributes['scaleFactor']?parseFloat(attrNode.attributes['scaleFactor'].value):0.0;this.isDefault=true;for(var name in window.SETTINGS){if(this.value)this.value.replace('['+name+']',window.SETTINGS[name]);if(this.defaultValue)this.defaultValue.replace('['+name+']',window.SETTINGS[name]);}
this.assign();this._super(boundModel,modelNode.tagName,modelNode.attributes['typename'].value,this.name,this.dt,this.arrayLength,this.expression);},rootGetter:function(){return this.first().getter();},rootSetter:function(value){this.first().setter(value);},insertBefore:function(binding){if(binding.value==undefined||binding.value==null||binding.value==[]||(this.value!=this.defaultValue&&binding.value==binding.defaultValue)){binding.assignValue(this.value);}
this._super(binding);},insertAfter:function(binding){binding.assignValue(this.value);this._super(binding);},assign:function(){this.assignValue(this.defaultValue);if(this.modelNode.attributes[this.name])this.assignValue(this.modelNode.attributes[this.name].value);if(this.dataNode)this.assignValue(this.dataNode.attributes[this.name].value);this.initValue();}});})();﻿
(function(){JSO.Client.DataBinding.XMLDataClass=JSO.Client.LinkedList.extend({framework:'JSO.Client',constructor:JSO.Client.DataBinding.XMLDataClass,construct:function(id,rootTypename){this.datanode=JSO.Client.Globals.DAL.getXMLNode('id',id,xmlDoc.getElementsByTagName('data')[0]);this.metanode=JSO.Client.Globals.DAL.getXMLNode('typename',this.datanode.tagName,xmlDoc.getElementsByTagName('meta')[0]);this.id=id||-1;this.idString=padNumber((this.id==-1?0:this.id),32);this.typename=this.datanode.tagName;this.metatype=this.metanode.tagName;this.name=this.datanode.attributes['name']?this.datanode.attributes['name'].value:this.typename+this.idString;this.inheritsFrom=this.metanode.attributes['inheritsFrom']?this.metanode.attributes['inheritsFrom'].value:'';this.rootTypename=rootTypename;this.framework=this.metanode.attributes['framework']?this.metanode.attributes['framework'].value:'';this.content=this.metanode.attributes['content']?this.metanode.attributes['content'].value:'';this.typechain=[];this.typeChainString='';this.attributes=this.attributes||{};this.attributeList=[];this.childIds=[];this.bindings={};this.bound=false;this.dirty=false;this.hasExpression=false;this.loadTypeChain(this.metanode,this.typename);this.attributeList.sort();this.loadAttributes();for(var name in this.attributes){this[name]=this.attributes[name].first().value;}
var childNodes=this.datanode.childNodes;for(var i=0;i<childNodes.length;i++){if(JSO.Client.Globals.DAL.isValidXMLNode(childNodes[i])){var data=JSO.Client.Globals.DAL.getXMLNode('id',childNodes[i].attributes['id'].value,xmlDoc.getElementsByTagName('data')[0]);var meta=JSO.Client.Globals.DAL.getXMLNode('typename',data.tagName,xmlDoc.getElementsByTagName('meta')[0]);this.childIds.push({id:childNodes[i].attributes['id'].value,typename:data.tagName,rootTypename:JSO.Client.Globals.DAL.cache.types[data.tagName].rootTypename,metatype:meta.tagName});}}
if(this.framework)this.bindings[this.framework]=JSO.Client.DataBinding.External.Factory.create(this.content,this.framework,this);if(this.hasExpression)this.bindings.expression=new JSO.Client.DataBinding.ExpressionClass(this);for(var name in this.attributes){var attr=this.attributes[name].first();attr.value=JSO.Client.Globals.parsers.parse(attr.value,attr.dt);if(this.framework||this.hasExpression){Object.defineProperty(this,name,{get:attr.find('XMLAttribute').rootGetter.bind(attr.find('XMLAttribute')),set:attr.find('XMLAttribute').rootSetter.bind(attr.find('XMLAttribute'))});this[name]=attr.value;}else{this[name]=attr.value;}}
this._super();},loadTypeChain:function(nod,typename){if(nod.attributes['inheritsFrom']){var nextNode=JSO.Client.Globals.DAL.getXMLNode('typename',nod.attributes['inheritsFrom'].value,xmlDoc.getElementsByTagName('meta')[0]);if(nod.attributes['inheritsFrom']&&nod.attributes['inheritsFrom'].value!=typename)this.loadTypeChain(nextNode,nod.attributes['inheritsFrom'].value);}
this.typechain.push(nod);this.typeChainString=this.typeChainString+(this.typeChainString==''?'':'.')+typename;if(nod.attributes['framework'])this.framework=nod.attributes['framework'].value
if((nod.tagName=='boundModel'&&JSO.Client.Model.Factory.hasType(typename))||(nod.tagName=='view'&&JSO.Client.View.Factory.hasType(typename)))this.rootTypename=typename;var i=nod.attributes.length;while(i--){if(this.attributeList.indexOf(nod.attributes[i].name)==-1)this.attributeList.push(nod.attributes[i].name);}
var attr=nod.firstChild;while(attr!=undefined){if(JSO.Client.Globals.DAL.isValidXMLNode(attr)){if(this.attributeList.indexOf(attr.attributes['typename'].value)==-1)this.attributeList.push(attr.attributes['typename'].value);}
attr=attr.nextSibling;}},loadAttributes:function(){for(var i=0;i<this.typechain.length;i++){var objectNode=this.typechain[i];if(objectNode){for(var j=0;j<this.attributeList.length;j++){var xmlAttr=JSO.Client.Globals.DAL.getXMLNode('typename',this.attributeList[j],objectNode);var dataAttr=this.attributes[this.attributeList[j]];if(dataAttr==undefined&&xmlAttr!=undefined){if(JSO.Client.Globals.DAL.isValidXMLNode(xmlAttr)){dataAttr=new JSO.Client.DataBinding.XMLAttribute(this,objectNode,xmlAttr);this.attributes[dataAttr.name]=dataAttr;if(dataAttr.expression)this.hasExpression=true;}}else if(dataAttr!=undefined){var nextAttr=new JSO.Client.DataBinding.XMLAttribute(this,objectNode,xmlAttr||dataAttr.attrNode);dataAttr.clonable=false;dataAttr.insertBefore(nextAttr);dataAttr.channel=JSO.Client.Globals.BINDING_CHANNEL.NONE;this.attributes[nextAttr.name]=nextAttr;if(nextAttr.expression)this.hasExpression=true;}}}}
var m=this.datanode.attributes.length;while(m--){var dataAttr=this.attributes[this.datanode.attributes[m].name];if(dataAttr){var nextAttr=new JSO.Client.DataBinding.XMLAttribute(this,dataAttr.modelNode,dataAttr.attrNode,this.datanode);dataAttr.clonable=false;dataAttr.insertBefore(nextAttr);dataAttr.channel=JSO.Client.Globals.BINDING_CHANNEL.NONE;this.attributes[nextAttr.name]=nextAttr;if(nextAttr.expression)this.hasExpression=true;}}},auditChain:function(){for(var name in this.attributes){console.log(this.typeChainString+'.'+name);console.log(this.attributes[name].auditChain());}},destroy:function(){if(this.visible)this.hide();for(var name in this.attributes){this.attributes[name].first().destroy();if(this.bindings)delete this.bindings;delete this.attributes[name];delete this[name];}
this._super();this.attributes={};this.bindings={};},show:function(){if(this.framework&&this.bindings[this.framework])this.bindings[this.framework].show();if(this.events.show&&!this.visible){if(this.eventContext)this.events.show.apply(this.eventContext,[this]);}
this.visible=true;},hide:function(){if(this.framework&&this.bindings[this.framework])this.bindings[this.framework].hide();if(this.events.hide&&this.visible){if(this.eventContext)this.events.hide.apply(this.eventContext,[this]);}
this.visible=false;}});})();﻿
(function(){JSO.Client.DataBinding.External=JSO.Client.DataBinding.extend({constructor:JSO.Client.DataBinding.External,construct:function(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,getmap,setmap,scaleFactor){this.getmap=getmap;this.setmap=setmap;this.scaleFactor=scaleFactor;this._super(boundModel,modelMetatype,modelTypename,name,dt,arrayLength,getmap+','+setmap);},doGet:function(){if(!this.boundModel||!this.boundModel.el)return undefined;this.value=this.boundModel.el[this.getmap]();if(this.scaleFactor>0){this.value=JSO.Client.Globals.scaleValue(this.value,this.dt,1/this.scaleFactor);}
return this.value;},doSet:function(value){if(!this.boundModel||!this.boundModel.visible||!this.boundModel.el)return;this.value=JSO.Client.Globals.parsers.parse(value,this.dt);if(this.scaleFactor>0){this.value=JSO.Client.Globals.scaleValue(this.value,this.dt,this.scaleFactor);}
this.boundModel.el[this.setmap](this.value);}});})();﻿
(function(){JSO.Client.DataBinding.Box2DBinding=JSO.Client.DataBinding.External.extend({typename:'Box2DBinding',framework:'Box2D',constructor:JSO.Client.DataBinding.Box2DBinding});})();﻿
(function(){JSO.Client.DataBinding.Box2DObject=JSO.Client.DataBinding.FrameworkClass.extend({typename:'Box2DObject',framework:'Box2D',_renderGarbage:[],constructor:JSO.Client.DataBinding.Box2DObject,construct:function(boundModel){boundModel.bodyDef=new Box2D.Dynamics.b2BodyDef;boundModel.fixDef=new Box2D.Dynamics.b2FixtureDef;boundModel.bodyDef.type=boundModel.bodyType;boundModel.bodyDef.bullet=false;boundModel.world=JSO.Client.Globals.gameController.model.el;boundModel.fixDef.density=(boundModel.density)?boundModel.density:.3;boundModel.fixDef.friction=(boundModel.friction)?boundModel.friction:0;boundModel.fixDef.restitution=(boundModel.restitution)?boundModel.restitution:.3;var scaleX=boundModel.scale.x/boundModel.attributes.scale.scaleFactor;var scaleY=boundModel.scale.y/boundModel.attributes.scale.scaleFactor;switch(boundModel.content.toLowerCase()){case'rect':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape();boundModel.fixDef.shape.SetAsBox(scaleX,scaleY);break;case'circle':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2CircleShape();boundModel.fixDef.shape.m_radius=scaleX/2;break;case'ellipse':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2CircleShape();break;case'line':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape();boundModel.fixDef.shape.SetAsBox(scaleX,scaleY);break;case'path':break;case'polygon':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape();boundModel.fixDef.shape.SetAsBox(scaleX,scaleY);break;case'regularPolygon':boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape();boundModel.fixDef.shape.SetAsBox(scaleX,scaleY);break;default:boundModel.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape();boundModel.fixDef.shape.SetAsBox(scaleX,scaleY);}
boundModel.world.Step();boundModel.el=boundModel.world.CreateBody(boundModel.bodyDef);for(var name in boundModel.attributes){var attr=boundModel.attributes[name].first();attr.boundModel=boundModel;if(attr.getmap!=''||attr.setmap!=''){attr.insertBefore(new JSO.Client.DataBinding.Box2DBinding(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,attr.getmap,attr.setmap,attr.scaleFactor));attr.framework=boundModel.framework;}}
this._super(boundModel);},show:function(){if(this.boundModel.el){this.boundModel.world.Step();this.boundModel.fixDef=this.boundModel.el.CreateFixture(this.boundModel.fixDef);if(this.boundModel.collidable){var filter=this.boundModel.fixDef.GetFilterData();if(!JSO.Client.Globals.collisionBits[this.boundModel.typename]){JSO.Client.Globals.collisionBits[this.boundModel.typename]=JSO.Client.Globals.uniqueBit();}
filter.categoryBits=JSO.Client.Globals.collisionBits[this.boundModel.typename];if(this.boundModel.collisionlist.length>0){this.boundModel.maskBits=0;for(var i=0;i<this.boundModel.collisionlist.length;i++){if(!JSO.Client.Globals.collisionBits[this.boundModel.collisionlist[i]]&&this.boundModel.collisionlist[i]!=''){JSO.Client.Globals.collisionBits[this.boundModel.collisionlist[i]]=JSO.Client.Globals.uniqueBit();}
var bit=JSO.Client.Globals.collisionBits[this.boundModel.collisionlist[i]];this.boundModel.maskBits=this.boundModel.maskBits|bit;}
filter.maskBits=this.boundModel.maskBits;}
this.boundModel.fixDef.SetFilterData(filter);}}},hide:function(){if(this.boundModel.fixDef&&!this.boundModel._isDestroyed&&this.boundModel.visible){if(this.boundModel.fixDef){var filter=this.boundModel.fixDef.GetFilterData();filter.maskBits=0;this.boundModel.fixDef.SetFilterData(filter);}}},destroy:function(){this.boundModel.bodyType=0;this.boundModel.position=new Box2D.Common.Math.b2Vec2(0,0);this.hide(this.boundModel);this.boundModel.world=nothing;JSO.Client.Globals.gameController.model.bindings.box2d._renderGarbage.push(this.boundModel);this._super();}});})();﻿
(function(){JSO.Client.DataBinding.Box2DWorld=JSO.Client.DataBinding.FrameworkClass.extend({typename:'Box2DWorld',framework:'Box2D',_renderGarbage:[],constructor:JSO.Client.DataBinding.ExpressionClass,construct:function(boundModel){var allowSleep=true;this.TARGET_RATE=.1;this.garbageCounter=0;this.dumpGarbageOn=3000;boundModel.el=new Box2D.Dynamics.b2World(boundModel.gravity||new Box2D.Common.Math.b2Vec2(0,0),allowSleep);this._super(boundModel);},renderFn:function(timer){this.garbageCounter++;if(this._renderGarbage.length&&this.garbageCounter==this.dumpGarbageOn){destroyObject(this._renderGarbage.pop());this.el.ClearForces();this.garbageCounter=0;}
this.boundModel.el.Step(this.TARGET_RATE,VELOCITY_ITERATIONS,POSITION_ITERATIONS);},destroyObject:function(data){if(data.fixDef!=null){if(data.el!=undefined){this.boundModel.el.DestroyBody(data.el);}
data.el=null;data.fixDef=null;this.el.ClearForces();}},show:function(){this.boundModel.renderFn=this.renderFn.bind(this);},hide:function(){boundModel.renderFn=undefined;}});})();﻿
(function(){JSO.Client.DataBinding.KineticJSBinding=JSO.Client.DataBinding.External.extend({typename:'KineticJSBinding',framework:'KineticJS',constructor:JSO.Client.DataBinding.KineticJSBinding});})();﻿
(function(){JSO.Client.DataBinding.KineticJSObject=JSO.Client.DataBinding.FrameworkClass.extend({typename:'KineticJSObject',framework:'KineticJS',_renderGarbage:[],constructor:JSO.Client.DataBinding.KineticJSObject,construct:function(boundModel){var el={};switch(boundModel.content){case'rect':boundModel.el=new Kinetic.Rect({});break;case'circle':boundModel.el=new Kinetic.Circle({});break;case'ellipse':boundModel.el=new Kinetic.Ellipse({});break;case'line':boundModel.el=new Kinetic.Line({});break;case'path':boundModel.el=new Kinetic.Path({});break;case'polygon':boundModel.el=new Kinetic.Polygon({});break;case'regularPolygon':boundModel.el=new Kinetic.RegularPolygon({});break;case'image':if(JSO.Client.Globals.DAL.images[boundModel.imagename]){img=JSO.Client.Globals.DAL.images[boundModel.imagename].image;boundModel.el=new Kinetic.Image({image:img,x:0,y:0,width:0,height:0});try{boundModel.el.crop.x=img.width;boundModel.el.crop.y=img.height;}catch(e){}}else{boundModel.el=new Kinetic.Image({x:0,y:0,width:0,height:0,crop:{x:0,y:0,width:0,height:0}});};break;case'sprite':boundModel.el=new Kinetic.Sprite({});break;default:};boundModel.layer=JSO.Client.Globals.gameController.firstView.el;boundModel.el.id=boundModel.uid;boundModel.layer.add(boundModel.el);boundModel.el.setVisible(false);for(var name in boundModel.attributes){var attr=boundModel.attributes[name].first();attr.boundModel=boundModel;if(attr.getmap!=''||attr.setmap!=''){attr.insertBefore(new JSO.Client.DataBinding.KineticJSBinding(boundModel,boundModel.metatype,boundModel.typename,attr.name,attr.dt,attr.arrayLength,attr.getmap,attr.setmap,attr.scaleFactor));attr.framework=boundModel.framework;}}
this._super(boundModel);},show:function(){this.boundModel.el.setVisible(true);},hide:function(){if(!this.boundModel._isDestroyed&&this.boundModel.visible){this.boundModel.el.setVisible(false);}},destroy:function(){this.hide();JSO.Client.Globals.gameController.firstView.bindings.kineticjs._renderGarbage.push(this.boundModel.el);this._super();}});})();﻿
(function(){JSO.Client.DataBinding.KineticJSStage=JSO.Client.DataBinding.FrameworkClass.extend({typename:'KineticJSStage',framework:'KineticJS',_renderGarbage:[],constructor:JSO.Client.DataBinding.KineticJSStage,construct:function(boundModel){boundModel.stage=new Kinetic.Stage({container:window.container});boundModel.stage.width=800;boundModel.el=new Kinetic.Layer();this._super(boundModel);},show:function(){this.boundModel.renderFn=this.renderFn.bind(this);this.boundModel.stage.add(this.boundModel.el);},hide:function(){this.boundModel.renderFn=undefined;},destroy:function(){JSO.Client.Globals.gameController.firstView.bindings.kineticjs._renderGarbage.push(this.boundModel.el);},renderFn:function(timer){this.boundModel.el.draw();if(this._renderGarbage.length){var el=this._renderGarbage.pop();if(el!=undefined)el.remove();}}});})();(function(){factory=function(){if(arguments.callee._singleton)
return arguments.callee._singleton;arguments.callee._singleton=this;};factory.prototype={create:function(typename,framework,boundModel){switch(framework.toLowerCase()){case'box2d':switch(typename.toLowerCase()){case'world':return new JSO.Client.DataBinding.Box2DWorld(boundModel);break;default:return new JSO.Client.DataBinding.Box2DObject(boundModel);};break;case'kineticjs':switch(typename.toLowerCase()){case'stage':return new JSO.Client.DataBinding.KineticJSStage(boundModel);break;default:return new JSO.Client.DataBinding.KineticJSObject(boundModel);};break;default:return;}}};JSO.Client.DataBinding.External={};JSO.Client.DataBinding.External.Factory=new factory();})();﻿(function(){JSO.Client.Timer=function(context,process,fps,delay,callback,callbackContext){this.uid=JSO.Client.Globals.uniqueId();this.metatype='timer';this.requestId=0;this.timeoutId=0;this.startTime=0;this.frameTime=Date.now();this.lastTime=Date.now();this.ticks=0;this.fps=fps||60;this.fpsFilter=10;this.fpsFrame=this.fpsFilter;this.fpsAvg=0.0;this.process=process;this.context=context||this;this.callback=callback;this.delay=delay||0;this.start=function(_this){_this=_this||this;_this.frameTime=Date.now()-_this.lastTime;_this.fpsFrame=_this.frameTime==0?0:1000/_this.frameTime;_this.fpsAvg+=(_this.fpsFrame-_this.fpsAvg)/_this.fpsFilter;_this.lastTime=Date.now();_this.ticks++;this.timeoutId=setTimeout(function(){_this.startTime=_this.startTime==0?Date.now():_this.startTime;if(!_this.delay||_this.delay>0&&Date.now()-_this.startTime>_this.delay*1000){_this.requestId=requestAnimationFrame(function(){if(_this.process!=undefined)_this.process.apply(_this.context,[arguments[0],_this]);if(_this.delay)_this.destroy();});}
_this.start.apply(_this,arguments);},1000/_this.fps);}
this.stop=function(){if(this.timeoutId)window.clearTimeout(this.timeoutId);this.timeoutId=0;if(this.requestId)window.cancelAnimationFrame(this.requestId);this.requestId=0;this.startTime=0;}
this.destroy=function(){if(this.requestId||this.timeoutId)this.stop();this.process=undefined;if(this.callback){this.callback(callbackContext,this);}}};})();﻿
(function(){var Base=namespace('JSO.Client.Base');JSO.Client.Base=JSO.Client.DataBinding.XMLDataClass.extend({constructor:JSO.Client.Base,construct:function(id,typename,metatype){this.id=id;this.metatype=metatype||JSO.Client.Globals.MODEL;this.typename=typename;this.initialized=false;this._isDestroyed=false;if(this.metatype!=JSO.Client.Globals.CONTROLLER&&id)this._super(id,typename);},destroy:function(){this.parent=null;this._super();},initialize:function(){this.initialized=true;if(this.next)this.next.initialize();},saveObject:function(){JSO.Client.Globals.DAL.saveObject(this,false);},deleteObject:function(){JSO.Client.Globals.DAL.deleteObject(this);}});})();﻿
(function()
{var Model=namespace('JSO.Client.Model');JSO.Client.Model=JSO.Client.Base.extend({constructor:JSO.Client.Model,construct:function(id,typename,metatype){this._super(id,typename,JSO.Client.Globals.MODEL);},initialize:function(){this._super();},show:function(){if(this.framework&&this.bindings[this.framework])this.bindings[this.framework].show(this);if(this.next)this.next.show();},update:function(){if(this.next)this.next.update();},destroy:function(){this.parent=null;this._super();}});factory=function(){if(arguments.callee._singleton)
return arguments.callee._singleton;arguments.callee._singleton=this;};factory.prototype={create:function(id,typename){switch(typename){case'event':return new JSO.Client.Model.Event(id,typename);break;case'action':return new JSO.Client.Model.Action(id,typename);break;case'fn':return new JSO.Client.Model.Fn(id,typename);break;case'game':return new JSO.Client.Model.Game(id,typename);break;case'window':return new JSO.Client.Model.Window(id,typename);break;case'level':return new JSO.Client.Model.Level(id,typename);break;case'camera':return new JSO.Client.Model.Camera(id,typename);break;case'object':return new JSO.Client.Model.Object(id,typename);break;case'actor':return new JSO.Client.Model.Actor(id,typename);break;case'player':return new JSO.Client.Model.Player(id,typename);break;case'image':return new JSO.Client.Model.Image(id,typename);break;case'animation':return new JSO.Client.Model.Animation(id,typename);break;case'tween':return new JSO.Client.Model.Tween(id,typename);break;case'emitter':return new JSO.Client.Model.Emitter(id,typename);break;case'particle':return new JSO.Client.Model.Particle(id,typename);break;default:return new JSO.Client.Model(id,typename);};},hasType:function(typename){return(JSO.Client.Model.Factory.typesArray.indexOf(typename)!=-1);}};factory.prototype.types='base,event,action,fn,game,window,level,camera,object,actor,player,image,animation,tween,emitter,particle';factory.prototype.typesArray=factory.prototype.types.split(',');JSO.Client.Model.Factory=new factory();})();﻿
(function()
{JSO.Client.Model.Action=JSO.Client.Model.extend({constructor:JSO.Client.Model.Action,construct:function(id,typename,metatype){this._super(id,typename||'action');}});})();﻿
(function()
{JSO.Client.Model.Animation=JSO.Client.Model.extend({constructor:JSO.Client.Model.Animation,construct:function(id,typename,metatype){this._super(id,typename||'animation');this.animstep=0;this.rowIndex=0;},initialize:function(){this.stepcount=this.imagewidth/this.scale.x;if(this.rowmap&&this.rowmap.length>0){this.rowcount=(this.rowmap instanceof Array&&this.rowmap.length>0?this.rowmap.length:1);}else{this.rowcount=this.imageheight/this.scale.y;}
this.rowthresh=360/this.rowcount;this.rotationmod=0;if(this.currentrow==-1)this.autoRowCalc=1;this._super();},animate:function(){this.animstep+=this.direction;if((this.animstep>=this.stepcount&&this.direction>0)||(this.animstep<=0&&this.direction<0)){switch(this.cycle){case'continuous':this.animstep=0;break;case'reverse':this.animstep=this.direction>0?this.stepcount-1:0;this.direction=-this.direction;break;default:}}
this.prevrotationmod=this.rotationmod;var parentRot=this.parent.rotation;var rowmap=this.rowmap;var rowthresh=this.rowthresh;if(this.autoRowCalc){if(this.parent.fixedRotation===false||this.parent.fixedRotation==='false'||this.parent.fixedRotation===0){var rowIndex=Math.round(parentRot/rowthresh)-1;rowIndex=!rowmap.length?0:rowIndex>rowmap.length?0:rowIndex<0?rowmap.length-1:rowIndex;this.currentrow=(rowmap instanceof Array&&rowmap.length>0?rowmap[rowIndex]:0);}else{this.rowIndex=this.parent.orientation.x==1&&this.parent.orientation.y==0?0:this.parent.orientation.x==1&&this.parent.orientation.y==1?2:this.parent.orientation.x==0&&this.parent.orientation.y==1?1:this.parent.orientation.x==-1&&this.parent.orientation.y==1?3:this.parent.orientation.x==-1&&this.parent.orientation.y==0?4:this.parent.orientation.x==-1&&this.parent.orientation.y==1?5:this.parent.orientation.x==-1&&this.parent.orientation.y==-1?6:this.parent.orientation.x==0&&this.parent.orientation.y==-1?7:0;this.currentrow=this.rowmap[this.rowIndex];}}
this.rotationmod=(parentRot-(Math.round(parentRot/rowthresh)*rowthresh));}});})();﻿
(function()
{JSO.Client.Model.Emitter=JSO.Client.Model.extend({constructor:JSO.Client.Model.Emitter,construct:function(id,typename,metatype){this._super(id,typename||'emitter');this.particleCounter=0;this.totalCounter=0;}});})();﻿
(function()
{JSO.Client.Model.Event=JSO.Client.Model.extend({constructor:JSO.Client.Model.Event,construct:function(id,typename,metatype){this._super(id,typename||'event');this.fireOnce=true;this.listen=true;},destroy:function(){this.eventOf={};if(this.eventname){var eventname=this.eventname.toLowerCase();if(KEY_EVENTS.match(eventname)){delete JSO.Client.Globals.gameController.Event.keyEvents[eventname+this.keyname];}else if(COLLIDE_EVENTS.match(eventname)){delete JSO.Client.Globals.gameController.Event.collideEvents['begincontact'+this.uidString];}else if(MOBILE_EVENTS.match(eventname)){delete JSO.Client.Globals.gameController.Event.mobileEvents[eventname];}}
this._super();}});})();﻿
(function()
{JSO.Client.Model.Fn=JSO.Client.Model.extend({constructor:JSO.Client.Model.Fn,construct:function(id,typename,metatype){this._super(id,typename||'fn');this.target=undefined;},execute:function(){if(this.target==undefined)return;if(this.targetAttr!=undefined&&this.targetAttr!=""&&this.param1==undefined){return false;};var param1=this.param1;if(this.param1!=''&&this.datatype!=''){param1=JSO.Client.Globals.parsers.parse(this.param1,this.datatype);}
if(this.targetAttr){var setval=this.target[this.targetAttr];switch(this.typename.toLowerCase()){case'setfn':setval=param1;break;case'add':setval+=param1;break;case'subtract':setval-=param1;break;case'multiply':setval*=param1;break;case'divide':setval/=param1;break;case'addv':setval.Add(param1);break;case'subtractv':setval.Subtract(param1);break;case'multiplyv':setval.Multiply(param1);break;case'dividev':setval.Divide(param1);break;case'dotv':b2Math.b2Dot(setval,param1);break;case'crossv':b2Math.b2CrossVV(setval,param1);break;default:}
this.target[this.targetAttr]=setval;}else{if(this.mapFn){this.target.el[this.mapFn](param1);}else{switch(this.typename.toLowerCase()){case'applyimpulse':this.target.el.ApplyImpulse(this.force,this.target.el.GetWorldPoint(this.point));break;case'applyforce':this.target.el.ApplyForce(this.force,this.target.el.GetWorldPoint(this.point));break;default:this.target[this.typename](param1);}}}},destroy:function(){this.target=null;this._super();}});})();﻿
(function()
{JSO.Client.Model.Game=JSO.Client.Model.extend({constructor:JSO.Client.Model.Game,construct:function(id,typename,metatype){this._super(id,'game');this.listenerlist=[];this.listen=1;this.running=false;},initialize:function(){this.lasttime=0;JSO.Client.Globals.PLAYFIELD_SCALE=this.scale;JSO.Client.Globals.GOAL_RESOLUTION=this.goalResolution;this.gridDimensions=this.scale.Divide(this.goalResolution);this.grid=new PF.Grid(Math.floor(this.gridDimensions.x)+10,Math.floor(this.gridDimensions.y)+10);this._super();},step:function(time,timer){if(this.renderFn)this.renderFn(timer);}});})();﻿
(function()
{JSO.Client.Model.Level=JSO.Client.Model.extend({constructor:JSO.Client.Model.Level,construct:function(id,typename,metatype){this._super(id,typename||'level');}});})();﻿
(function()
{JSO.Client.Model.Tween=JSO.Client.Model.extend({constructor:JSO.Client.Model.Tween,construct:function(id,typename,metatype){this._super(id,typename||'tween');this.time=0;this.cycle='none';this.direction=1;this.attributes=new Array();},update:function(){this._super();},reset:function(){this.time=0;this.direction=1;}});})();﻿
(function()
{JSO.Client.Model.Window=JSO.Client.Model.extend({constructor:JSO.Client.Model.Window,construct:function(id,typename,metatype){this._super(id,typename||'window');}});})();﻿
(function()
{JSO.Client.Model.Object=JSO.Client.Model.extend({constructor:JSO.Client.Model.Object,construct:function(id,typename,metatype){this._super(id,typename||'object');this.goals=[];this.screenPosition=new Box2D.Common.Math.b2Vec2(0,0);this.gridPos=new Box2D.Common.Math.b2Vec2(0,0);this.acceleration=new Box2D.Common.Math.b2Vec2(0,0);this.orientation=new Box2D.Common.Math.b2Vec2(0,0);this.direction=new Box2D.Common.Math.b2Vec2(0,0);this._calcGoal=false;},initialize:function(){this.GOAL_RESOLUTION=JSO.Client.Globals.GOAL_RESOLUTION;this.PLAYFIELD_SCALE=JSO.Client.Globals.PLAYFIELD_SCALE;this.scaleHeight=Math.round(this.scale.y/this.GOAL_RESOLUTION.y);this.scaleWidth=Math.round(this.scale.x/this.GOAL_RESOLUTION.x);if(!this.grid){this.grid=JSO.Client.Globals.gameController.model.grid;}
this.goalAvoidSign=this.goalAvoid?-1:1;this.gridPos=new Box2D.Common.Math.b2Vec2(Math.round((this.position.x+(this.PLAYFIELD_SCALE.x/2))/this.GOAL_RESOLUTION.x),Math.round((this.position.y+(this.PLAYFIELD_SCALE.y/2))/this.GOAL_RESOLUTION.y));if(this.typeChainString.indexOf('actor')==-1)this.grid.setWalkableAt(this.gridPos.x,this.gridPos.y,false);for(var name in this.attributes){this[name]=this[name];}
this.mainCam=JSO.Client.Globals.gameController.cameras[0].model;this._super();},update:function(){var vel=this.velocity.Copy();var rot=this.rotation;if(this.acceleration.x>0||this.acceleration.y>0||this.acceleration.x<0||this.acceleration.y<0)vel=this.velocity.Add(this.acceleration);if(vel.x>.01||vel.x<-.01){this.direction.x=Math.cos(rot*(Math.PI/180));}
if(vel.y>.01||vel.y<-.01){this.direction.y=Math.sin(rot*(Math.PI/180));}
vel.x=((vel.x<0.01&&vel.x>0)||(vel.x>-0.01&&vel.x<0)?1:vel.x);vel.y=((vel.y<0.01&&vel.y>0)||(vel.y>-0.01&&vel.y<0)?1:vel.y);if(vel.x>=0){vel.x=vel.x<this.minVelocity.x?-this.minVelocity.x:vel.x>this.maxVelocity.x?this.maxVelocity.x:vel.x;}else{vel.x=vel.x>-this.minVelocity.x?this.minVelocity.x:vel.x<-this.maxVelocity.x?-this.maxVelocity.x:vel.x;}
if(vel.y>=0){vel.y=vel.y<this.minVelocity.y?-this.minVelocity.y:vel.y>this.maxVelocity.y?this.maxVelocity.y:vel.y;}else{vel.y=vel.y>-this.minVelocity.y?this.minVelocity.y:vel.y<-this.maxVelocity.y?-this.maxVelocity.y:vel.y;}
if(vel.x!==this.velocity.x||vel.y!==this.velocity.y){this.velocity=vel;}
if(this.angularImpulse){rot=Math.floor(Math.abs(rot)/360)>0?rot+((rot>0?-1:1)*(Math.floor(Math.abs(rot)/360)*360)):rot;rot+=this.angularImpulse;this.rotation=(rot<0?rot+360:(rot>360?rot-360:rot));this.orientation=new Box2D.Common.Math.b2Vec2(Math.cos(this.rotation*(Math.PI/180)),Math.sin(this.rotation*(Math.PI/180)));}
this._super();var pos=this.position.Copy();if(this.mainCam.isInView(pos,this.scale)){this.screenPosition=this.mainCam.lookAt(pos);this.inView=true;}else if(this.inView){this.screenPosition=this.mainCam.lookAt(pos);this.inView=false;}},destroy:function(){this.mainCam=null;this._super();}});})();﻿
(function()
{JSO.Client.Model.Image=JSO.Client.Model.Object.extend({constructor:JSO.Client.Model.Image,construct:function(id,typename,metatype){this._super(id,typename||'image');}});})();﻿
(function()
{JSO.Client.Model.Actor=JSO.Client.Model.Object.extend({constructor:JSO.Client.Model.Actor,construct:function(id,typename,metatype){this._super(id,typename||'actor');this.lastUpdated=0;},initialize:function(){if(this.goalmethod){switch(this.goalmethod.toLowerCase()){case'astar':this.goalfinder=new PF.AStarFinder();break;case'breadthfirst':this.goalfinder=new PF.BreadthFirstFinder();break;case'bestfirst':this.goalfinder=new PF.BestFirstFinder();break;case'dijkstra':this.goalfinder=new PF.DijkstraFinder();break;case'biastar':this.goalfinder=new PF.BiAStarFinder();break;case'bibestfirst':this.goalfinder=new PF.BiBestFirstFinder();break;case'bidijkstra':this.goalfinder=new PF.BiDijkstraFinder();break;case'bibreadthfirst':this.goalfinder=new PF.BiBreadthFirstFinder();break;case'jumppoint':this.goalfinder=new PF.JumpPointFinder();break;default:}
if(this.goalfinder){this.goalfinder.allowDiagonal=true;this.goalfinder.dontCrossCorners=true;}
if(this.goalheuristic&&this.goalfinder){switch(this.goalheuristic.toLowerCase()){case'manhattan':this.goalfinder.heuristic=PF.Heuristic.manhattan;break;case'chebyshev':this.goalfinder.heuristic=PF.Heuristic.chebyshev;break;case'euclidean':this.goalfinder.heuristic=PF.Heuristic.euclidean;break;default:}}}
this._super();},update:function(){if(this.angularImpulse>0||this.angularImpulse<0){this.angularImpulse=this.angularImpulse-((this.angularImpulse<0?-1:1)*this.angularDamping/GAME_REFRESH_FPS);}
this.velocityNormal=this.velocity.Copy();this.velocityNormal.Normalize();if((this._calcGoal&&!GOAL_REFRESH_FPS)||(this._calcGoal&&this.goals.length==0))this.goalFind();this._super();},goalFind:function(){if(!this._calcGoal)return
var vx=this.velocity.x;var vy=this.velocity.y;var nextPos=new Box2D.Common.Math.b2Vec2(this.position.x+vx+(this.PLAYFIELD_SCALE.x>>1),this.position.y+vy+(this.PLAYFIELD_SCALE.y>>1));var nextGridPos=new Box2D.Common.Math.b2Vec2(0,0);nextGridPos.x=isNaN(nextPos.x)?0:parseInt(nextPos.x/this.GOAL_RESOLUTION.x);nextGridPos.y=isNaN(nextPos.y)?0:parseInt(nextPos.y/this.GOAL_RESOLUTION.y);nextGridPos.x=Math.round(nextGridPos.x<this.scaleWidth?this.scaleWidth:nextGridPos.x>=this.grid.width-this.scaleWidth?this.grid.width-this.scaleWidth:nextGridPos.x);nextGridPos.y=Math.round(nextGridPos.y<this.scaleHeight?this.scaleHeight:nextGridPos.y>=this.grid.height-this.scaleHeight?this.grid.height-this.scaleHeight:nextGridPos.y);if(this.goals.length>0&&this.goalListen){var goalX=this.goals[0].gridPos.x;var goalY=this.goals[0].gridPos.y;this.path=this.goalfinder.findPath(nextGridPos.x,nextGridPos.y,goalX,goalY,this.grid.clone())
var inRadius=true;var dist=0;var pathLen=this.path.length;var goalstrength=this.goalstrength;if(pathLen>1){var distX=this.path[1][0]-nextGridPos.x;var distY=this.path[1][1]-nextGridPos.y;squaredDist=(distX*distX)+(distY*distY);dist=Math.sqrt(squaredDist);if(this.goalradius!=undefined){var goalDistX=goalX-nextGridPos.x;var goalDistY=goalY-nextGridPos.y;var squaredGoalDist=(goalDistX*goalDistX)+(goalDistY*goalDistY);inRadius=(squaredGoalDist<=(this.goalradius^2));}}
if(pathLen>1&&inRadius){var xSign=(distX!=0?distX/Math.abs(distX):(Math.abs(vx)!=0?vx/Math.abs(vx):1));var ySign=(distY!=0?distY/Math.abs(distY):(Math.abs(vy)!=0?vy/Math.abs(vy):1));var strengthX=((dist==0?1:Math.abs(distX)/dist)*xSign);var strengthY=((dist==0?1:Math.abs(distY)/dist)*ySign);vx=Math.abs(vx)*strengthX;vy=Math.abs(vy)*strengthY;vx=(vx+(goalstrength?goalstrength*xSign:0))*this.goalAvoidSign;vy=(vy+(goalstrength?goalstrength*ySign:0))*this.goalAvoidSign;var vel=new Box2D.Common.Math.b2Vec2(this.velocity.x+vx,this.velocity.y+vy);if(vel.x!==this.velocity.x||vel.y!==this.velocity.y){this.velocity=vel;}
if(this.fixedRotation===0||this.fixedRotation==='false'||this.fixedRotation===false){var rot=this.rotation*DEGREES_TO_RADS;var angle=Math.atan2(this.velocity.y,this.velocity.x);var delta=angle-rot;var delta_abs=Math.abs(delta);if(delta_abs>Math.PI){delta=delta_abs-(2*Math.PI);}
if(delta*RADS_TO_DEGREES<-this.goalOrientationThresh||delta*RADS_TO_DEGREES>this.goalOrientationThresh){var direction=delta/delta_abs;if(delta_abs*RADS_TO_DEGREES>180)direction*=-1;this.angularImpulse+=direction*(delta_abs/RADS_TO_DEGREES)*this.goalOrientationStrength;}else{this.angularImpulse=0;}}}}
delete nextPos;this.gridPos=nextGridPos;},destroy:function(){this.goals.length=0;this.grid=null;this._super();}});})();﻿
(function()
{JSO.Client.Model.Camera=JSO.Client.Model.Actor.extend({constructor:JSO.Client.Model.Camera,construct:function(id,typename,metatype){this._super(id,typename||'camera');},isInView:function(pos,scale){var camPos=this.position.Copy(),camScale=this.scale.Copy();var cam={left:camPos.x-(camScale.x/2),right:camPos.x+(camScale.x/2),top:camPos.y-(camScale.y/2),bottom:camPos.y+(camScale.y/2)}
var obj={left:pos.x-(scale.x/2),right:pos.x+(scale.x/2),top:pos.y-(scale.y/2),bottom:pos.y+(scale.y/2)}
delete camPos;delete camScale;return intersect(cam,obj);},lookAt:function(pos){var thisPos=this.position;return new Box2D.Common.Math.b2Vec2(pos.x-thisPos.x,pos.y-thisPos.y);}});})();﻿
(function()
{JSO.Client.Model.Particle=JSO.Client.Model.Actor.extend({constructor:JSO.Client.Model.Particle,construct:function(id,typename,metatype){this._super(id,typename||'particle');this.time=0;this.spawned=false;}});})();﻿
(function()
{JSO.Client.Model.Player=JSO.Client.Model.Actor.extend({constructor:JSO.Client.Model.Player,construct:function(id,typename,metatype){this._super(id,typename||'player');}});})();﻿
(function()
{var View=namespace("JSO.Client.View");JSO.Client.View=JSO.Client.Base.extend({constructor:JSO.Client.View,construct:function(id,typename){this._super(id,typename,JSO.Client.Globals.VIEW);this.eventsInitialized=false;this.listen=true;},initialize:function(model){this.model=model;this._super();},update:function(model){this.model=model;if(this.next)this.next.update();},DISPLAY_CANVAS:1,DISPLAY_HTML:2});factory=function(){if(arguments.callee._singleton)
return arguments.callee._singleton;arguments.callee._singleton=this;};factory.prototype={create:function(id,typename){switch(typename){case'htmlElement':return new JSO.Client.View.HTMLElement(id,typename);break;case'canvasElement':return new JSO.Client.View.CanvasElement(id,typename);break;case'windowView':return new JSO.Client.View.Window(id,typename);break;case'gameWindow':return new JSO.Client.View.GameWindow(id,typename);break;case'levelView':return new JSO.Client.View.Level(id,typename);break;case'animationView':return new JSO.Client.View.Animation(id,typename);break;case'tweenView':return new JSO.Client.View.Tween(id,typename);break;case'layerView':return new JSO.Client.View.Layer(id,typename);break;default:return new JSO.Client.View(id,typename);};},hasType:function(typename){return(JSO.Client.View.Factory.typesArray.indexOf(typename)!=-1);}};factory.prototype.types='base,htmlElement,canvasElement,windowView,gameWindow,levelView,animationView,tweenView,layerView';factory.prototype.typesArray=factory.prototype.types.split(',');JSO.Client.View.Factory=new factory();})();﻿
(function()
{JSO.Client.View.Animation=JSO.Client.View.extend({constructor:JSO.Client.View.Animation,construct:function(id,typename){this._super(id,typename||'animation');},initialize:function(model){if(this.parent.el.getImage()){this.parent.el.setImage(JSO.Client.Globals.DAL.images[this.imagename].image);this.parent.el.attrs.width=this.parent.width;this.parent.el.attrs.height=this.parent.height;this.parent.el.setCrop(this.model.scale.x,this.model.scale.y);this.parent.el.attrs.crop.x=0;this.parent.el.attrs.crop.y=0;}
this._super(model);},update:function(model){if(model==undefined||this.parent==undefined)return;if(this.parent.el==undefined||!this.parent.visible)return;this.parent.el.attrs.crop.x=model.animstep*model.scale.x;this.parent.el.attrs.crop.y=model.currentrow*model.scale.y;if(isNumeric(model.rotationmod)&&model.rotationmod!=model.prevrotationmod){this.parent.el.setRotationDeg(model.rotationmod);}
this._super(model);}});})();﻿
(function()
{JSO.Client.View.CanvasElement=JSO.Client.View.extend({constructor:JSO.Client.View.CanvasElement,construct:function(id,typename){this._super(id,typename||'canvasElement');},initialize:function(){for(var name in this.attributes){this[name]=this[name];}
this.el.setVisible(true);this.inView=true;this._super();},update:function(model){if(model.inView&&!this.inView){this.el.setVisible(true);this.inView=true;}else if(!model.inView&&this.inView){this.el.setVisible(false);this.inView=false;}
this._super(model);}});})();﻿
(function()
{JSO.Client.View.GameWindow=JSO.Client.View.extend({constructor:JSO.Client.View.GameWindow,construct:function(id,typename){this._super(id,typename||'gameWindow');},initialize:function(){this.stage.setWidth(JSO.Client.Globals.gameController.cameras[0].model.scale.x/2);this.stage.setHeight(JSO.Client.Globals.gameController.cameras[0].model.scale.y/2);this._super();},render:function(time){if(this.renderFn){this.renderFn(time);}}});})();﻿
(function()
{JSO.Client.View.HTMLElement=JSO.Client.View.extend({constructor:JSO.Client.View.HTMLElement,construct:function(id,typename){this._super(id,typename||'htmlElement');},initialize:function(){this._super();},getElement:function(){}});})();﻿
(function()
{JSO.Client.View.Level=JSO.Client.View.extend({constructor:JSO.Client.View.Level,construct:function(id,typename){this._super(id,typename||'level');}});})();﻿
(function()
{JSO.Client.View.Tween=JSO.Client.View.extend({constructor:JSO.Client.View.Tween,construct:function(id,typename){this._super(id,typename||'tween');},update:function(model){if(model==undefined||this.parent==undefined)return;this._super(model);}});})();﻿
(function()
{JSO.Client.View.Window=JSO.Client.View.extend({constructor:JSO.Client.View.Window,construct:function(id,typename){this._super(id,typename||'window');}});})();﻿
(function()
{var Controller=namespace("JSO.Client.Controller");JSO.Client.Controller=JSO.Client.LinkedList.extend({constructor:JSO.Client.Controller,construct:function(model,parent){this._super();this.metatype=JSO.Client.Globals.CONTROLLER
this.parent=parent;this.parentView=undefined;this.layer=undefined;this.initialized=false;this._isDestroyed=false;this.timers=new EventArray('push',this.addChild,this);if(model)this.addChild(null,model);},addChild:function(event,child){switch(child.metatype){case'model':this.id=child.id;this.name=child.name;this.typename=child.typename;this.model=child;if(this.parent!=undefined){child.parent=this.parent.model;}
child.events.destroy=this.destroyModel.bind(this);child.eventContext=this;if(isNumeric(this.id)&&this.id!=-1){for(var i=0;i<child.childIds.length;i++){var childNode=child.childIds[i];this.loadChild(childNode);}}
break;case'view':if(!this.firstView)this.firstView=child;else this.firstView.last().insertAfter(child);if(this.parent!=undefined){child.parent=this.parent.firstView;}
child.model=this.model;this.parentView=child;for(var i=0;i<child.childIds.length;i++){var childNode=child.childIds[i];this.loadChild(childNode);}
break;case'controller':if(this.parentView)child.parentView=this.parentView;if(!this.firstChild)this.firstChild=child;else this.firstChild.last().insertAfter(child);child.parent=this;break;case'timer':child.start();break;default:}},loadChild:function(child){if(child==undefined)return;switch(child.metatype){case'view':var view=JSO.Client.View.Factory.create(child.id,child.rootTypename);this.addChild(undefined,view);break;default:var controller=JSO.Client.Controller.Factory.create(JSO.Client.Model.Factory.create(child.id,child.rootTypename),this);this.addChild(undefined,controller);break;}},initialize:function(){this.model.initialize();if(this.firstView)this.firstView.initialize();this.initialized=true;},update:function(time,timer){if(!this._isDestroyed&&!this.model._isDestroyed){if(!this.initialized)this.initialize();if(this.model&&this.model.visible)this.model.update();if(this.firstView&&this.firstView.visible)this.firstView.update(this.model);}
if(this.firstChild)this.firstChild.update(time,timer);if(this.next)this.next.update(time,timer);},show:function(){if(this.model)this.model.show();if(this.firstView)this.firstView.show();if(this.firstChild)this.firstChild.show();if(this.next)this.next.show();},hide:function(){if(this.model)this.model.hide();if(this.firstView)this.firstView.hide();if(this.firstChild)this.firstChild.hide();},destroyChain:function(){if(this.next)this.next.destroyChain();this.model.destroy();},destroy:function(){var i=this.timers.length
while(i--){this.timers[i].destroy();}
this.timers.length=0;var queue=new JSO.Client.ExecutionQueue(this._super.bind(this),this,undefined,undefined,undefined,GAME_REFRESH_FPS/10);if(this.firstView)queue=new JSO.Client.ExecutionQueue(this.firstView.destroy,this.firstView,undefined,undefined,queue,GAME_REFRESH_FPS/10);if(this.firstChild)queue=new JSO.Client.ExecutionQueue(this.firstChild.destroyChain,this.firstChild,undefined,undefined,queue,GAME_REFRESH_FPS/10);JSO.Client.Globals.gameController.executionQueues.push(queue);},destroyChild:function(child){if(child.uid==this.firstChild.first().uid&&child.next)this.firstChild=child.next;},destroyModel:function(mdl){this.destroy();},destroyTimer:function(context,timer){var i=context.timers.length;while(i--){if(context.timers[i].uid==timer.uid)context.timers.splice(i,1);}},isMatch:function(obj,metatype,typename,name,id,uid){return(((metatype)?obj.metatype==metatype:true)&&((typename)?obj.typename==typename:true)&&((name)?obj.name==name:true)&&((id)?obj.id==id:true)&&((uid)?obj.uid==uid:true));},matchNode:function(metatype,typename,name,id,uid){var found=null;if(metatype==JSO.Client.Globals.CONTROLLER||metatype==''){if(this.isMatch(this,JSO.Client.Globals.CONTROLLER,typename,name,id,uid))found=this;if(this.isMatch(this,JSO.Client.Globals.MODEL,typename,name,id,uid))found=this;if(this.isMatch(this,JSO.Client.Globals.VIEW,typename,name,id,uid))found=this;}
if(this.model&&(metatype==JSO.Client.Globals.MODEL||metatype=='')&&found==null){if(this.isMatch(this.model,(metatype?JSO.Client.Globals.MODEL:undefined),typename,name,id,uid)&&found==null)found=this.model;}
if(this.firstView&&(metatype==JSO.Client.Globals.VIEW||metatype=='')&&found==null){var view=this.firstView;while(view){if(this.isMatch(view,(metatype?JSO.Client.Globals.VIEW:undefined),typename,name,id,uid)&&found==null)found=view;view=view.next;}}
return found;},findUp:function(metatype,typename,name,id,uid,searched){if(searched[this.uid])return searched;searched.found=this.matchNode(metatype,typename,name,id,uid);if(searched.found!=null)return searched;searched=this.findDown(metatype,typename,name,id,uid,searched);if(searched.found!=null)return searched;searched.nodes[this.uid]=this.uid;if(this.parent){searched=this.parent.findUp(metatype,typename,name,id,uid,searched);if(searched.found!=null)return searched;}
return searched;},findDown:function(metatype,typename,name,id,uid,searched){if(searched.nodes[this.uid])return searched;searched.found=this.matchNode(metatype,typename,name,id,uid);if(searched.found!=null)return searched;var child=this.firstChild;while(child){if(searched.nodes[child.uid]===undefined){searched=child.findDown(metatype,typename,name,id,uid,searched);if(searched.found!=null)return searched;}
var child=child.next;}
searched.nodes[this.uid]=this.uid;return searched;},find:function(metatype,typename,name,id,uid,searched){if(searched==undefined){var searched={nodes:{},found:null}}
searched=this.findDown(metatype,typename,name,id,uid,searched);if(searched.found!=null)return searched.found;searched=this.findUp(metatype,typename,name,id,uid,searched);return searched.found;}});factory=function(){if(arguments.callee._singleton)
return arguments.callee._singleton;arguments.callee._singleton=this;};factory.prototype={create:function(model,parent){var controller={};switch(model.rootTypename){case'event':controller=new JSO.Client.Controller.Event(model,parent);break;case'action':controller=new JSO.Client.Controller.Action(model,parent);break;case'fn':controller=new JSO.Client.Controller.Fn(model,parent);break;case'game':controller=new JSO.Client.Controller.Game(model,parent);break;case'image':controller=new JSO.Client.Controller.Image(model,parent);break;case'object':controller=new JSO.Client.Controller.Object(model,parent);break;case'camera':controller=new JSO.Client.Controller.Camera(model,parent);break;case'actor':controller=new JSO.Client.Controller.Actor(model,parent);break;case'emitter':controller=new JSO.Client.Controller.Emitter(model,parent);break;case'particle':controller=new JSO.Client.Controller.Particle(model,parent);break;case'animation':controller=new JSO.Client.Controller.Animation(model,parent);break;case'tween':controller=new JSO.Client.Controller.Tween(model,parent);break;default:controller=new JSO.Client.Controller(model,parent);};return controller;},hasType:function(typename){return(JSO.Client.Controller.Factory.typesArray.indexOf(typename)!=-1);}};factory.prototype.types='base,event,action,fn,game,image,object,camera,actor,emitter,particle,animation,tween';factory.prototype.typesArray=factory.prototype.types.split(',');JSO.Client.Controller.Factory=new factory();})();﻿
(function()
{JSO.Client.Controller.Action=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Action,construct:function(model,parent){this._super(model,parent);},execute:function(){var child=this.firstChild;while(child){child.execute();child=child.next;}}});})();﻿
(function()
{JSO.Client.Controller.Animation=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Animation,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();var timer=new JSO.Client.Timer(this.model,this.model.animate,this.model.fps);this.timers.push(timer);this.model.animate();}});})();﻿
(function()
{JSO.Client.Controller.Emitter=JSO.Client.Controller.extend({_emitted:false,constructor:JSO.Client.Controller.Emitter,construct:function(model,parent){this._super(model,parent);this._emitted=false
this.currentParticleId=0;},initialize:function(){this._super();this.particleLoopBuffer=[];if(this.model.cached===true||this.model.cached===1||this.model.cached==='true')this.fillParticleCache();if(this.model.delay>0){var timer=new JSO.Client.Timer(this,this.emit,1/this.model.delay);this.timers.push(timer);}},fillParticleCache:function(){var m=this.model.totalCount;while(m--){this.particleLoopBuffer.push(this.getParticleSet());}},getParticleSet:function(){var particleSet=[];var i=this.model.childIds.length;while(i--){var childData=this.model.childIds[i];if(childData.rootTypename=='actor'||childData.rootTypename=='particle'){var p=this.model.emitNumber;while(p--){var particle=JSO.Client.Controller.Factory.create(JSO.Client.Model.Factory.create(childData.id,childData.rootTypename),this);particleSet.push(particle);}}}
return particleSet;},emit:function(){this._emitted=true;var emitter=this.model;if(emitter.totalCounter>=emitter.totalCount&&emitter.totalCount!=0)return;if(emitter.particleCounter>=emitter.maxCount&&emitter.maxCount>0)return;var particleSet=[];if((this.model.cached===true||this.model.cached===1||this.model.cached==='true')&&this.particleLoopBuffer.length>0){particleSet=this.particleLoopBuffer.pop();}else{particleSet=this.getParticleSet();}
JSO.Client.Globals.gameController.executionQueues.push(new JSO.Client.ExecutionQueue(this.emitParticle,this,particleSet,null,null,60));this.model.particleCounter++;this.model.totalCounter++;if(this.model.cached){this.currentParticleId++;if(this.currentParticleId>this.particleLoopBuffer.length)this.currentParticleId=0;}},emitParticle:function(particle){if(!particle||particle===undefined||particle===null)return;if(particle.events)particle.events['destroy']=this.destroyChild;else particle.events={};particle.events.destroy=this.destroyChild;particle.eventContext=this;particle.firstView.inView=true;for(var name in particle.model.attributes){var attr=particle.model.attributes[name].first();if(attr.framework.toLowerCase()=='expression'){particle.model[name]=particle.model[name];attr.remove();}}
if(!this.firstChild)this.firstChild=particle;else this.firstChild.last().insertAfter(particle);particle.show();},emitComplete:function(){this._isEmitting=false;},show:function(){if(this.next)this.next.show();},destroy:function(){this.particleLoopBuffer=[];this._super();},destroyChild:function(child){this.model.particleCounter--;this._super(child);},addChild:function(event,child){if(child.metatype=='controller'){var rootTypename=JSO.Client.Globals.DAL.cache.types[child.typename].rootTypename;if((rootTypename!='actor'&&rootTypename!='particle')||this._emitted){this._super(event,child);}}else this._super(event,child);},loadChild:function(child){if(child.metatype=='model'){var rootTypename=JSO.Client.Globals.DAL.cache.types[child.typename].rootTypename;if((rootTypename!='actor'&&rootTypename!='particle')||this._emitted){this._super(child);}}else this._super(child);}});})();﻿
(function()
{JSO.Client.Controller.Event=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Event,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();var eventname=this.model.eventname.toLowerCase();if(this.parentView!=undefined){if(COLLIDE_EVENTS.match(eventname)!=null){JSO.Client.Globals.gameController.Event.box2DCollide_bind(this);}else if(KEY_EVENTS.match(eventname)!=null){window['on'+eventname]=JSO.Client.Globals.gameController.Event.keyEvent_handler;JSO.Client.Globals.gameController.Event.keyEvents[eventname+this.model.keyname]=this;}else if(MOUSE_EVENTS.match(eventname)!=null&&this.parentView.el){this.parentView.el.on(eventname,function(__event){this.raise(__event,this);});}else if(MOBILE_EVENTS.match(eventname)!=null){$("body").bind(eventname,JSO.Client.Globals.gameController.Event.mobileEvent_handler);JSO.Client.Globals.gameController.Event.mobileEvents[eventname]=this;}else{if(this.parentView.tag){var tag=this.parentView.tag;if(typeof $(tag).get(0)[eventname]=='object'&&$(tag).get(0)[eventname]===null){tag['on'+eventname]=function(__event){this.raise(__event,this);};}}}}},raise:function(e,event){if((this.model.listen==false||this.model.listen=='false'||this.model.listen==0)||JSO.Client.Globals.gameController.model.listen===0)return;if(this.model.action&&this.parent){var child=this.parent.firstChild;while(child){var act=child.model;if(act.rootTypename=='action'){if(act.actionname==this.model.action){child.execute();return;}}
child=child.next;}
if(typeof this.eventOf[this.model.action]=='function'){this.parent.model[this.model.action](e,event);}}else if(typeof this.eventOf[this.model.action]=='function'){this.parent.model[this.model.action](e,event);}},destroy:function(){this._super();}});})();﻿
(function()
{JSO.Client.Controller.Fn=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Fn,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();var fnMdl=this.model;this.model.target=this.find(fnMdl.targetMetatype,fnMdl.targetTypename,fnMdl.targetName,fnMdl.targetId);},execute:function(){if(this.model.delay>0){var timer=new JSO.Client.Timer(this.model,this.model.execute,null,this.model.delay,this.destroyTimer,this);this.timers.push(timer);}else{this.model.execute(arguments);}
var child=this.firstChild;while(child){if(child.typeChainString.indexOf('action')>-1||child.typeChainString.indexOf('fn')>-1)child.execute(arguments);child=child.next;};}});})();﻿
(function()
{var Game=namespace("JSO.Client.Game");JSO.Client.Controller.Game=JSO.Client.Game=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Game,construct:function(){JSO.Client.Globals.gameController=this;JSO.Client.Globals.DAL.loadCache();this.cameras=new Array();this.executionQueues=[];this._super(JSO.Client.Model.Factory.create(1,'game'));},update:function(time,timer){if(this.running){window.GAME_LOOP_TIME=time;var i=this.executionQueues.length;while(i--){this.executionQueues[i].doNext();if(this.executionQueues[i].complete)this.executionQueues.splice(i,1);}
this._super(time,timer);if(DEBUG)if(timer)console.log(timer.frameTime,timer.fpsFrame,timer.fpsAvg);if(!PHYSICS_REFRESH_FPS)this.model.step(time,timer);if(!RENDER_REFRESH_FPS)this.firstView.render(time,timer);}},start:function(){if(this.running){return;}
var self=this;this.running=true;this.show();this.initialize();var timer=new JSO.Client.Timer(this,this.update,GAME_REFRESH_FPS);this.timers.push(timer);if(PHYSICS_REFRESH_FPS){this.model.step();var timer=new JSO.Client.Timer(this.model,this.model.step,PHYSICS_REFRESH_FPS);this.timers.push(timer);}
if(RENDER_REFRESH_FPS){this.firstView.render();var timer=new JSO.Client.Timer(this.firstView,this.firstView.render,RENDER_REFRESH_FPS);this.timers.push(timer);}},Event:{keyEvents:{},collideEvents:[],mobileEvents:{},listeners:{},keyEvent_bind:function(ctrl){},keyEvent_handler:function(e){if(KEY_EVENTS.match(e.type)){var code=(e.keyCode)?e.keyCode:e.which;var key=code==32?'space':String.fromCharCode(code).toLowerCase();if(JSO.Client.Globals.gameController.Event.keyEvents[e.type+key]){JSO.Client.Globals.gameController.Event.keyEvents[e.type+key].raise(e);}}},mobileEvent_bind:function(ctrl){},mobileEvent_handler:function(e){if(MOBILE_EVENTS.match(e.type)){if(JSO.Client.Globals.gameController.Event.mobileEvents[e.type]){JSO.Client.Globals.gameController.Event.mobileEvents[e.type].raise(e);}}},box2DCollide_bind:function(ctrl){if(this.listeners['begincontact']==undefined){this.listeners['begincontact']=this.addContactListener('begincontact');}
JSO.Client.Globals.gameController.Event.collideEvents['begincontact'+ctrl.model.uidString]=ctrl;ctrl.parent.model.el.SetUserData(ctrl.model.uidString);},box2DCollide_handler:function(evtName,uidA,uidB,contact,impulse){if(JSO.Client.Globals.gameController.model.listen==0)return;var evtA=JSO.Client.Globals.gameController.Event.collideEvents[evtName+uidA];var evtB=JSO.Client.Globals.gameController.Event.collideEvents[evtName+uidB];if(evtA&&evtB&&evtA.parent.model.el&&evtB.parent.model.el){if(evtA.model.targettypes.indexOf(evtB.parent.model.typename)>-1){if(evtA.model.raiseOnce===true||evtA.model.raiseOnce=='true'||evtA.model.raiseOnce==1)delete JSO.Client.Globals.gameController.Event.collideEvents[evtName+uidA];evtA.raise(contact,evtName);if(evtA.model.raiseOnce==false||evtA.model.raiseOnce=='false'||evtA.model.raiseOnce==0){JSO.Client.Globals.gameController.Event.collideEvents['begincontact'+evtA.model.uidString]=evtA;evtA.parent.model.el.SetUserData(evtA.model.uidString);}}
if(evtB.model.targettypes.indexOf(evtA.parent.model.typename)>-1){if(evtB.model.raiseOnce===true||evtB.model.raiseOnce=='true'||evtB.model.raiseOnce==1)delete JSO.Client.Globals.gameController.Event.collideEvents[evtName+uidB];evtB.raise(contact,evtName);if(evtB.model.raiseOnce==false||evtB.model.raiseOnce=='false'||evtB.model.raiseOnce==0){JSO.Client.Globals.gameController.Event.collideEvents['begincontact'+evtB.model.uidString]=evtB;evtB.parent.model.el.SetUserData(evtB.model.uidString);}}}},addContactListener:function(evtName){var listener=new Box2D.Dynamics.b2ContactListener;switch(evtName.toLowerCase()){case'begincontact':listener.BeginContact=function(contact){JSO.Client.Globals.gameController.Event.box2DCollide_handler('begincontact',contact.GetFixtureA().GetBody().GetUserData(),contact.GetFixtureB().GetBody().GetUserData(),contact);}
break;case'endcontact':listener.BeginContact=function(contact){JSO.Client.Globals.gameController.Event.box2DCollide_handler('endcontact',contact.GetFixtureA().GetBody().GetUserData(),contact.GetFixtureB().GetBody().GetUserData(),contact);}
break;case'postsolve':listener.BeginContact=function(contact){JSO.Client.Globals.gameController.Event.box2DCollide_handler('postsolve',contact.GetFixtureA().GetBody().GetUserData(),contact.GetFixtureB().GetBody().GetUserData(),contact,impulse.normalImpulses[0]);}
break;}
JSO.Client.Globals.gameController.model.el.SetContactListener(listener);return evtName;}}});})();﻿
(function()
{JSO.Client.Controller.Resource=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Resource,construct:function(model,parent){this._super(model,parent);}});})();﻿
(function()
{JSO.Client.Controller.Tween=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Tween,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();var timer=new JSO.Client.Timer(this.model,this.model.animate,this.model.fps);this.timers.push(timer);}});})();﻿
(function()
{JSO.Client.Controller.Window=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Window,construct:function(model,parent){this._super(model,parent);}});})();﻿
(function()
{JSO.Client.Controller.Object=JSO.Client.Controller.extend({constructor:JSO.Client.Controller.Object,construct:function(model,parent){this._super(model,parent);this.collideList=[];},initialize:function(){this._super();var mdl=this.model;if(mdl.goal!=''&&mdl.goal!=undefined){var goal=this.find(JSO.Client.Globals.MODEL,mdl.goal);goal._calcGoal=true;mdl._calcGoal=true;if(goal!=null){mdl.goals.push(goal);}}}});})();﻿
(function()
{JSO.Client.Controller.Image=JSO.Client.Controller.Object.extend({constructor:JSO.Client.Controller.Image,construct:function(model,parent){this._super(model,parent);}});})();﻿
(function()
{JSO.Client.Controller.Actor=JSO.Client.Controller.Object.extend({constructor:JSO.Client.Controller.Actor,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();if(GOAL_REFRESH_FPS){if(this.model._calcGoal){var timer=new JSO.Client.Timer(this.model,this.model.goalFind,GOAL_REFRESH_FPS);this.timers.push(timer);}}}});})();﻿
(function()
{JSO.Client.Controller.Camera=JSO.Client.Controller.Actor.extend({constructor:JSO.Client.Controller.Camera,construct:function(model,parent){this._super(model,parent);JSO.Client.Globals.gameController.cameras.push(this);}});})();﻿
(function()
{JSO.Client.Controller.Particle=JSO.Client.Controller.Actor.extend({constructor:JSO.Client.Controller.Particle,construct:function(model,parent){this._super(model,parent);},initialize:function(){this._super();if(this.model.delay>0){var timer=new JSO.Client.Timer(this,this.destroy,1/this.model.delay);this.timers.push(timer);}}});})();